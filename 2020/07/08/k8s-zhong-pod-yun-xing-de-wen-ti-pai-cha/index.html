<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="k8s中pod运行的问题排查, Java Android Python DevOps JamesLiAndroid 小李 运维 ">
    <meta name="baidu-site-verification" content>
    <meta name="google-site-verification" content>
    <meta name="360-site-verification" content>
    <meta name="description" content="关于pom文件版本号对于Dockerfile的影响我们之前的设定，对于pom文件中的版本感知不明显，导致我们在Dockerfile里面写死了jar包的版本号。
当pom文件中的版本号变更时，由于Dockerfile中未能及时变更，导致出现了">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>k8s中pod运行的问题排查 | 时代与猫的脚步</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?46e79e71af0709a5b9106bf20cecc493";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body>

    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">时代与猫的脚步</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <span>关于</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/contact" class="waves-effect waves-light">
            
            <span>留言板</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">时代与猫的脚步</div>
        <div class="logo-desc">
            
            山东理工大学 | 电子信息工程
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-link"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-link"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-link"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-link"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-link"></i>
                
                关于
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-link"></i>
                
                友情链接
            </a>
        </li>
        
        <li>
            <a href="/contact" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-link"></i>
                
                留言板
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/JamesLiAndroid" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/JamesLiAndroid" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/24.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        k8s中pod运行的问题排查
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        <span class="chip bg-color">无标签</span>
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-07-08
                </div>

                <div class="post-author info-break-policy">
                    <i class="fa fa-user-o fa-fw"></i>作者:&nbsp;&nbsp;
                    
                    JamesLiAndroid
                    
                </div>

                
                
                <div class="info-break-policy">
                    <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                    5k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    29 分
                </div>
                
                

                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="关于pom文件版本号对于Dockerfile的影响"><a href="#关于pom文件版本号对于Dockerfile的影响" class="headerlink" title="关于pom文件版本号对于Dockerfile的影响"></a>关于pom文件版本号对于Dockerfile的影响</h2><p>我们之前的设定，对于pom文件中的版本感知不明显，导致我们在Dockerfile里面写死了jar包的版本号。</p>
<p>当pom文件中的版本号变更时，由于Dockerfile中未能及时变更，导致出现了构建运行镜像失败的问题。</p>
<p>临时解决方式：</p>
<p>在构建时添加sed命令，用来修改Dockerfile中的版本不正确的问题。如下图：</p>
<p><img src="./imgs/%E4%BF%AE%E6%94%B9%E7%89%88%E6%9C%AC.png" alt></p>
<h2 id="关于k8s中服务反复重启导致无法对外访问的问题排查"><a href="#关于k8s中服务反复重启导致无法对外访问的问题排查" class="headerlink" title="关于k8s中服务反复重启导致无法对外访问的问题排查"></a>关于k8s中服务反复重启导致无法对外访问的问题排查</h2><p>以test-form-design-rdp服务为例子，日志如下：</p>
<pre><code>DEBUG 2020-06-10 13:45:53:361 main AgentPackagePath : The beacon class location is jar:file:/app/skywalking-agent/skywalking-agent.jar!/org/apache/skywalking/apm/agent/core/boot/AgentPackagePath.class.
INFO 2020-06-10 13:45:53:366 main SnifferConfigInitializer : Config file found in /app/skywalking-agent/config/agent.config.

  .   ____          _            __ _ _
 /\\ / ___&#39;_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | &#39;_ | &#39;_| | &#39;_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  &#39;  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::        (v2.2.6.RELEASE)

2020-06-10 13:46:08.622  INFO [test-form-rdp,,,] 6 --- [           main] c.a.n.c.c.impl.LocalConfigInfoProcessor  : LOCAL_SNAPSHOT_PATH:/root/nacos/config
2020-06-10 13:46:08.874  INFO [test-form-rdp,,,] 6 --- [           main] c.a.nacos.client.config.impl.Limiter     : limitTime:5.0
2020-06-10 13:46:09.042  WARN [test-form-rdp,,,] 6 --- [           main] c.a.c.n.c.NacosPropertySourceBuilder     : Ignore the empty nacos configuration and get it based on dataId[test-form-rdp] &amp; group[DEFAULT_GROUP]
2020-06-10 13:46:09.052  INFO [test-form-rdp,,,] 6 --- [           main] c.a.nacos.client.config.utils.JVMUtil    : isMultiInstance:false
2020-06-10 13:46:09.125  INFO [test-form-rdp,,,] 6 --- [           main] b.c.PropertySourceBootstrapConfiguration : Located property source: [BootstrapPropertySource {name=&#39;bootstrapProperties-test-form-rdp-standalone.yml,DEFAULT_GROUP&#39;}, BootstrapPropertySource {name=&#39;bootstrapProperties-test-form-rdp.yml,DEFAULT_GROUP&#39;}, BootstrapPropertySource {name=&#39;bootstrapProperties-test-form-rdp,DEFAULT_GROUP&#39;}]
2020-06-10 13:46:09.235  INFO [test-form-rdp,,,] 6 --- [           main] c.h.i.form.IcpCloudFormApplication       : The following profiles are active: standalone
2020-06-10 13:46:16.690  WARN [test-form-rdp,,,] 6 --- [           main] o.s.boot.actuate.endpoint.EndpointId     : Endpoint ID &#39;nacos-config&#39; contains invalid characters, please migrate to a valid format.
2020-06-10 13:46:18.605  INFO [test-form-rdp,,,] 6 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode!
2020-06-10 13:46:18.612  INFO [test-form-rdp,,,] 6 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data MongoDB repositories in DEFAULT mode.
2020-06-10 13:46:18.735  INFO [test-form-rdp,,,] 6 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 100ms. Found 0 MongoDB repository interfaces.
2020-06-10 13:46:18.812  INFO [test-form-rdp,,,] 6 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Multiple Spring Data modules found, entering strict repository configuration mode!
2020-06-10 13:46:18.819  INFO [test-form-rdp,,,] 6 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Bootstrapping Spring Data Redis repositories in DEFAULT mode.
2020-06-10 13:46:18.897  INFO [test-form-rdp,,,] 6 --- [           main] .s.d.r.c.RepositoryConfigurationDelegate : Finished Spring Data repository scanning in 6ms. Found 0 Redis repository interfaces.
2020-06-10 13:46:19.672  WARN [test-form-rdp,,,] 6 --- [           main] o.s.boot.actuate.endpoint.EndpointId     : Endpoint ID &#39;service-registry&#39; contains invalid characters, please migrate to a valid format.
2020-06-10 13:46:21.712  INFO [test-form-rdp,,,] 6 --- [           main] o.s.cloud.context.scope.GenericScope     : BeanFactory id=738057ce-da16-3790-9a18-b67c26d5c038
2020-06-10 13:46:26.888  INFO [test-form-rdp,,,] 6 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean &#39;org.springframework.security.config.annotation.configuration.ObjectPostProcessorConfiguration&#39; of type [org.springframework.security.config.annotation.configuration.ObjectPostProcessorConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2020-06-10 13:46:26.906  INFO [test-form-rdp,,,] 6 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean &#39;objectPostProcessor&#39; of type [org.springframework.security.config.annotation.configuration.AutowireBeanFactoryObjectPostProcessor] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2020-06-10 13:46:26.915  INFO [test-form-rdp,,,] 6 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean &#39;org.springframework.security.access.expression.method.DefaultMethodSecurityExpressionHandler@20a9f5fb&#39; of type [org.springframework.security.access.expression.method.DefaultMethodSecurityExpressionHandler] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2020-06-10 13:46:26.917  INFO [test-form-rdp,,,] 6 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean &#39;org.springframework.security.config.annotation.method.configuration.GlobalMethodSecurityConfiguration&#39; of type [org.springframework.security.config.annotation.method.configuration.GlobalMethodSecurityConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2020-06-10 13:46:26.969  INFO [test-form-rdp,,,] 6 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean &#39;org.springframework.security.config.annotation.method.configuration.Jsr250MetadataSourceConfiguration&#39; of type [org.springframework.security.config.annotation.method.configuration.Jsr250MetadataSourceConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2020-06-10 13:46:26.974  INFO [test-form-rdp,,,] 6 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean &#39;jsr250MethodSecurityMetadataSource&#39; of type [org.springframework.security.access.annotation.Jsr250MethodSecurityMetadataSource] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2020-06-10 13:46:26.980  INFO [test-form-rdp,,,] 6 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean &#39;methodSecurityMetadataSource&#39; of type [org.springframework.security.access.method.DelegatingMethodSecurityMetadataSource] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2020-06-10 13:46:27.028  INFO [test-form-rdp,,,] 6 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean &#39;redisCacheConfig&#39; of type [com.testsoft.icpcloud.common.cache.config.RedisCacheConfig$$EnhancerBySpringCGLIB$$c422b7ae] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2020-06-10 13:46:27.390  INFO [test-form-rdp,,,] 6 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean &#39;org.springframework.cloud.sleuth.instrument.web.client.TraceWebClientAutoConfiguration$TraceOAuthConfiguration&#39; of type [org.springframework.cloud.sleuth.instrument.web.client.TraceWebClientAutoConfiguration$TraceOAuthConfiguration] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2020-06-10 13:46:27.475  INFO [test-form-rdp,,,] 6 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean &#39;spring.sleuth.redis-org.springframework.cloud.sleuth.instrument.redis.TraceRedisProperties&#39; of type [org.springframework.cloud.sleuth.instrument.redis.TraceRedisProperties] is not eligible for getting processed by all BeanPostProcessors (for example: not eligible for auto-proxying)
2020-06-10 13:46:28.918  INFO [test-form-rdp,,,] 6 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 20041 (testtp)
2020-06-10 13:46:28.947  INFO [test-form-rdp,,,] 6 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2020-06-10 13:46:28.948  INFO [test-form-rdp,,,] 6 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.33]
2020-06-10 13:46:29.219  INFO [test-form-rdp,,,] 6 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2020-06-10 13:46:29.220  INFO [test-form-rdp,,,] 6 --- [           main] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 19798 ms
2020-06-10 13:46:30.020  WARN [test-form-rdp,,,] 6 --- [           main] c.n.c.sources.URLConfigurationSource     : No URLs will be polled as dynamic configuration sources.
2020-06-10 13:46:30.020  INFO [test-form-rdp,,,] 6 --- [           main] c.n.c.sources.URLConfigurationSource     : To enable URLs as dynamic configuration sources, define System property archaius.configurationSource.additionalUrls or make config.properties available on classpath.
2020-06-10 13:46:30.085  INFO [test-form-rdp,,,] 6 --- [           main] c.netflix.config.DynamicPropertyFactory  : DynamicPropertyFactory is initialized with configuration sources: com.netflix.config.ConcurrentCompositeConfiguration@4dd4965a
2020-06-10 13:46:30.566  INFO [test-form-rdp,,,] 6 --- [           main] c.a.d.s.b.a.DruidDataSourceAutoConfigure : Init DruidDataSource
Loading class `com.mysql.jdbc.Driver&#39;. This is deprecated. The new driver class is `com.mysql.cj.jdbc.Driver&#39;. The driver is automatically registered via the SPI and manual loading of the driver class is generally unnecessary.
2020-06-10 13:46:32.724  INFO [test-form-rdp,,,] 6 --- [           main] com.alibaba.druid.pool.DruidDataSource   : {dataSource-1} inited
2020-06-10 13:46:34.160  INFO [test-form-rdp,,,] 6 --- [           main] org.mongodb.driver.cluster               : Cluster created with settings {hosts=[mongo-outer.test-basic-mongo-outer:27017], mode=SINGLE, requiredClusterType=UNKNOWN, serverSelectionTimeout=&#39;30000 ms&#39;, maxWaitQueueSize=500}
2020-06-10 13:46:34.433  INFO [test-form-rdp,,,] 6 --- [           main] org.mongodb.driver.cluster               : Cluster description not yet available. Waiting for 30000 ms before timing out
2020-06-10 13:46:34.603  INFO [test-form-rdp,,,] 6 --- [ngo-outer:27017] org.mongodb.driver.connection            : Opened connection [connectionId{localValue:1, serverValue:391}] to mongo-outer.test-basic-mongo-outer:27017
2020-06-10 13:46:34.640  INFO [test-form-rdp,,,] 6 --- [ngo-outer:27017] org.mongodb.driver.cluster               : Monitor thread successfully connected to server with description ServerDescription{address=mongo-outer.test-basic-mongo-outer:27017, type=STANDALONE, state=CONNECTED, ok=true, version=ServerVersion{versionList=[4, 2, 7]}, minWireVersion=0, maxWireVersion=8, maxDocumentSize=16777216, logicalSessionTimeoutMinutes=30, roundTripTimeNanos=19311961}
2020-06-10 13:46:43.815  INFO [test-form-rdp,,,] 6 --- [           main] o.s.b.a.e.web.EndpointLinksResolver      : Exposing 2 endpoint(s) beneath base path &#39;/actuator&#39;
2020-06-10 13:46:46.083  WARN [test-form-rdp,,,] 6 --- [           main] c.n.c.sources.URLConfigurationSource     : No URLs will be polled as dynamic configuration sources.
2020-06-10 13:46:46.083  INFO [test-form-rdp,,,] 6 --- [           main] c.n.c.sources.URLConfigurationSource     : To enable URLs as dynamic configuration sources, define System property archaius.configurationSource.additionalUrls or make config.properties available on classpath.
2020-06-10 13:46:48.433  INFO [test-form-rdp,,,] 6 --- [           main] o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService &#39;applicationTaskExecutor&#39;
 _ _   |_  _ _|_. ___ _ |    _
| | |\/|_)(_| | |_\  |_)||_|_\
     /               |
                        3.3.1
2020-06-10 13:46:50.785  INFO [test-form-rdp,,,] 6 --- [           main] pertySourcedRequestMappingHandlerMapping : Mapped URL path [/v2/api-docs] onto method [springfox.documentation.swagger2.web.Swagger2Controller#getDocumentation(String, HttpServletRequest)]
2020-06-10 13:46:52.471  INFO [test-form-rdp,,,] 6 --- [           main] .s.s.UserDetailsServiceAutoConfiguration :

Using generated security password: 6595127a-b2c1-4947-9f73-c17b7a2c7002

2020-06-10 13:46:53.214  INFO [test-form-rdp,,,] 6 --- [           main] .r.c.IcpSecurityResourceServerConfigurer : IcpResourceServerAutoConfiguration is working!!!
2020-06-10 13:46:53.511  INFO [test-form-rdp,,,] 6 --- [           main] o.s.s.web.DefaultSecurityFilterChain     : Creating filter chain: any request, [org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@2ce80c85, org.springframework.security.web.context.SecurityContextPersistenceFilter@2ea3f905, org.springframework.security.web.header.HeaderWriterFilter@9fe1e14, org.springframework.security.web.authentication.logout.LogoutFilter@1e8f20bf, org.springframework.security.oauth2.provider.authentication.OAuth2AuthenticationProcessingFilter@1c027237, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@194feb27, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@3df920, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@25dd9eb6, org.springframework.security.web.session.SessionManagementFilter@41d34a11, org.springframework.security.web.access.ExceptionTranslationFilter@327fd5c9, org.springframework.security.web.access.intercept.FilterSecurityInterceptor@9a00385]
2020-06-10 13:46:54.159  WARN [test-form-rdp,,,] 6 --- [           main] ockingLoadBalancerClientRibbonWarnLogger : You already have RibbonLoadBalancerClient on your classpath. It will be used by default. As Spring Cloud Ribbon is in maintenance mode. We recommend switching to BlockingLoadBalancerClient instead. In order to use it, set the value of `spring.cloud.loadbalancer.ribbon.enabled` to `false` or remove spring-cloud-starter-netflix-ribbon from your project.
2020-06-10 13:46:54.918  INFO [test-form-rdp,,,] 6 --- [           main] o.s.c.n.eureka.InstanceInfoFactory       : Setting initial instance status as: STARTING
2020-06-10 13:46:55.075  INFO [test-form-rdp,,,] 6 --- [           main] com.netflix.discovery.DiscoveryClient    : Initializing Eureka in region us-east-1
2020-06-10 13:46:55.357  INFO [test-form-rdp,,,] 6 --- [           main] c.n.d.provider.DiscoveryJerseyProvider   : Using JSON encoding codec LegacyJacksonJson
2020-06-10 13:46:55.357  INFO [test-form-rdp,,,] 6 --- [           main] c.n.d.provider.DiscoveryJerseyProvider   : Using JSON decoding codec LegacyJacksonJson
2020-06-10 13:46:56.068  INFO [test-form-rdp,,,] 6 --- [           main] c.n.d.provider.DiscoveryJerseyProvider   : Using XML encoding codec XStreamXml
2020-06-10 13:46:56.068  INFO [test-form-rdp,,,] 6 --- [           main] c.n.d.provider.DiscoveryJerseyProvider   : Using XML decoding codec XStreamXml
2020-06-10 13:46:56.968  INFO [test-form-rdp,,,] 6 --- [           main] c.n.d.s.r.aws.ConfigClusterResolver      : Resolving eureka endpoints via configuration
2020-06-10 13:46:57.134  INFO [test-form-rdp,,,] 6 --- [           main] com.netflix.discovery.DiscoveryClient    : Disable delta property : false
2020-06-10 13:46:57.135  INFO [test-form-rdp,,,] 6 --- [           main] com.netflix.discovery.DiscoveryClient    : Single vip registry refresh property : null
2020-06-10 13:46:57.135  INFO [test-form-rdp,,,] 6 --- [           main] com.netflix.discovery.DiscoveryClient    : Force full registry fetch : false
2020-06-10 13:46:57.135  INFO [test-form-rdp,,,] 6 --- [           main] com.netflix.discovery.DiscoveryClient    : Application is null : false
2020-06-10 13:46:57.135  INFO [test-form-rdp,,,] 6 --- [           main] com.netflix.discovery.DiscoveryClient    : Registered Applications size is zero : true
2020-06-10 13:46:57.135  INFO [test-form-rdp,,,] 6 --- [           main] com.netflix.discovery.DiscoveryClient    : Application version is -1: true
2020-06-10 13:46:57.135  INFO [test-form-rdp,,,] 6 --- [           main] com.netflix.discovery.DiscoveryClient    : Getting all instance registry info from the eureka server
2020-06-10 13:46:58.190  INFO [test-form-rdp,,,] 6 --- [           main] com.netflix.discovery.DiscoveryClient    : The response status is 200
2020-06-10 13:46:58.197  INFO [test-form-rdp,,,] 6 --- [           main] com.netflix.discovery.DiscoveryClient    : Starting heartbeat executor: renew interval is: 30
2020-06-10 13:46:58.201  INFO [test-form-rdp,,,] 6 --- [           main] c.n.discovery.InstanceInfoReplicator     : InstanceInfoReplicator onDemand update allowed rate per min is 4
2020-06-10 13:46:58.215  INFO [test-form-rdp,,,] 6 --- [           main] com.netflix.discovery.DiscoveryClient    : Discovery Client initialized at timestamp 1591768018207 with initial instances count: 17
2020-06-10 13:46:58.239  INFO [test-form-rdp,,,] 6 --- [           main] o.s.c.n.e.s.EurekaServiceRegistry        : Registering application test-FORM-RDP with eureka with status UP
2020-06-10 13:46:58.242  INFO [test-form-rdp,,,] 6 --- [           main] com.netflix.discovery.DiscoveryClient    : Saw local status change event StatusChangeEvent [timestamp=1591768018242, current=UP, previous=STARTING]
2020-06-10 13:46:58.247  INFO [test-form-rdp,,,] 6 --- [           main] d.s.w.p.DocumentationPluginsBootstrapper : Context refreshed
2020-06-10 13:46:58.284  INFO [test-form-rdp,,,] 6 --- [nfoReplicator-0] com.netflix.discovery.DiscoveryClient    : DiscoveryClient_test-FORM-RDP/test-form-rdp@10.42.3.29:20041: registering service...
2020-06-10 13:46:58.493  INFO [test-form-rdp,,,] 6 --- [nfoReplicator-0] com.netflix.discovery.DiscoveryClient    : DiscoveryClient_test-FORM-RDP/test-form-rdp@10.42.3.29:20041 - registration status: 204
2020-06-10 13:46:58.593  INFO [test-form-rdp,,,] 6 --- [           main] d.s.w.p.DocumentationPluginsBootstrapper : Found 1 custom documentation plugin(s)
2020-06-10 13:46:58.794  INFO [test-form-rdp,,,] 6 --- [           main] s.d.s.w.s.ApiListingReferenceScanner     : Scanning for api listing references
2020-06-10 13:46:59.984  INFO [test-form-rdp,,,] 6 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 20041 (testtp) with context path &#39;&#39;
2020-06-10 13:46:59.988  INFO [test-form-rdp,,,] 6 --- [           main] .s.c.n.e.s.EurekaAutoServiceRegistration : Updating port to 20041
2020-06-10 13:46:59.996  INFO [test-form-rdp,,,] 6 --- [           main] c.h.i.form.IcpCloudFormApplication       : Started IcpCloudFormApplication in 58.544 seconds (JVM running for 66.916)
2020-06-10 13:47:00.017  INFO [test-form-rdp,,,] 6 --- [           main] c.a.n.client.config.impl.ClientWorker    : [fixed-192.168.229.211_18848-d79ba2e9-da64-40e8-9dcd-92cc24bcaf4e] [subscribe] test-form-rdp.yml+DEFAULT_GROUP+d79ba2e9-da64-40e8-9dcd-92cc24bcaf4e
2020-06-10 13:47:00.021  INFO [test-form-rdp,,,] 6 --- [           main] c.a.nacos.client.config.impl.CacheData   : [fixed-192.168.229.211_18848-d79ba2e9-da64-40e8-9dcd-92cc24bcaf4e] [add-listener] ok, tenant=d79ba2e9-da64-40e8-9dcd-92cc24bcaf4e, dataId=test-form-rdp.yml, group=DEFAULT_GROUP, cnt=1
2020-06-10 13:47:00.021  INFO [test-form-rdp,,,] 6 --- [           main] c.a.n.client.config.impl.ClientWorker    : [fixed-192.168.229.211_18848-d79ba2e9-da64-40e8-9dcd-92cc24bcaf4e] [subscribe] test-form-rdp+DEFAULT_GROUP+d79ba2e9-da64-40e8-9dcd-92cc24bcaf4e
2020-06-10 13:47:00.021  INFO [test-form-rdp,,,] 6 --- [           main] c.a.nacos.client.config.impl.CacheData   : [fixed-192.168.229.211_18848-d79ba2e9-da64-40e8-9dcd-92cc24bcaf4e] [add-listener] ok, tenant=d79ba2e9-da64-40e8-9dcd-92cc24bcaf4e, dataId=test-form-rdp, group=DEFAULT_GROUP, cnt=1
2020-06-10 13:47:00.022  INFO [test-form-rdp,,,] 6 --- [           main] c.a.n.client.config.impl.ClientWorker    : [fixed-192.168.229.211_18848-d79ba2e9-da64-40e8-9dcd-92cc24bcaf4e] [subscribe] test-form-rdp-standalone.yml+DEFAULT_GROUP+d79ba2e9-da64-40e8-9dcd-92cc24bcaf4e
2020-06-10 13:47:00.022  INFO [test-form-rdp,,,] 6 --- [           main] c.a.nacos.client.config.impl.CacheData   : [fixed-192.168.229.211_18848-d79ba2e9-da64-40e8-9dcd-92cc24bcaf4e] [add-listener] ok, tenant=d79ba2e9-da64-40e8-9dcd-92cc24bcaf4e, dataId=test-form-rdp-standalone.yml, group=DEFAULT_GROUP, cnt=1
2020-06-10 13:47:00.032  INFO [test-form-rdp,,,] 6 --- [cd-92cc24bcaf4e] c.a.n.client.config.impl.ClientWorker    : get changedGroupKeys:[]
2020-06-10 13:47:29.743  INFO [test-form-rdp,,,] 6 --- [cd-92cc24bcaf4e] c.a.n.client.config.impl.ClientWorker    : get changedGroupKeys:[]
2020-06-10 13:47:59.246  INFO [test-form-rdp,,,] 6 --- [cd-92cc24bcaf4e] c.a.n.client.config.impl.ClientWorker    : get changedGroupKeys:[]
2020-06-10 13:48:28.750  INFO [test-form-rdp,,,] 6 --- [cd-92cc24bcaf4e] c.a.n.client.config.impl.ClientWorker    : get changedGroupKeys:[]
2020-06-10 13:48:58.254  INFO [test-form-rdp,,,] 6 --- [cd-92cc24bcaf4e] c.a.n.client.config.impl.ClientWorker    : get changedGroupKeys:[]
2020-06-10 13:49:15.018  INFO [test-form-rdp,,,] 6 --- [extShutdownHook] o.s.c.n.e.s.EurekaServiceRegistry        : Unregistering application test-FORM-RDP with eureka with status DOWN
2020-06-10 13:49:15.019  WARN [test-form-rdp,,,] 6 --- [extShutdownHook] com.netflix.discovery.DiscoveryClient    : Saw local status change event StatusChangeEvent [timestamp=1591768155018, current=DOWN, previous=UP]
2020-06-10 13:49:15.020  INFO [test-form-rdp,,,] 6 --- [nfoReplicator-0] com.netflix.discovery.DiscoveryClient    : DiscoveryClient_test-FORM-RDP/test-form-rdp@10.42.3.29:20041: registering service...
2020-06-10 13:49:15.027  INFO [test-form-rdp,,,] 6 --- [nfoReplicator-0] com.netflix.discovery.DiscoveryClient    : DiscoveryClient_test-FORM-RDP/test-form-rdp@10.42.3.29:20041 - registration status: 204
2020-06-10 13:49:15.055  INFO [test-form-rdp,,,] 6 --- [extShutdownHook] o.s.s.concurrent.ThreadPoolTaskExecutor  : Shutting down ExecutorService &#39;applicationTaskExecutor&#39;
2020-06-10 13:49:15.198  INFO [test-form-rdp,,,] 6 --- [extShutdownHook] com.alibaba.druid.pool.DruidDataSource   : {dataSource-1} closing ...
2020-06-10 13:49:15.232  INFO [test-form-rdp,,,] 6 --- [extShutdownHook] com.alibaba.druid.pool.DruidDataSource   : {dataSource-1} closed
2020-06-10 13:49:15.239  INFO [test-form-rdp,,,] 6 --- [extShutdownHook] com.netflix.discovery.DiscoveryClient    : Shutting down DiscoveryClient ...
2020-06-10 13:49:18.241  INFO [test-form-rdp,,,] 6 --- [extShutdownHook] com.netflix.discovery.DiscoveryClient    : Unregistering ...
2020-06-10 13:49:18.253  INFO [test-form-rdp,,,] 6 --- [extShutdownHook] com.netflix.discovery.DiscoveryClient    : DiscoveryClient_test-FORM-RDP/test-form-rdp@10.42.3.29:20041 - deregister  status: 200
2020-06-10 13:49:18.274  INFO [test-form-rdp,,,] 6 --- [extShutdownHook] com.netflix.discovery.DiscoveryClient    : Completed shut down of DiscoveryClient
</code></pre><p>启动过程中，未发生任何错误，在启动完成后却出现了服务自动下线的情况，体现在Eureka中就是服务明明上线了，过一分钟左右就自动下线了。</p>
<p>目前怀疑是k8s的健康检查干掉了正在运行的服务，这时候需要排查配置文件和k8s部署文件的区别。</p>
<p>配置文件如下：</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>form<span class="token punctuation">-</span>rdp
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">mongodb</span><span class="token punctuation">:</span>
      <span class="token key atrule">uri</span><span class="token punctuation">:</span> mongodb<span class="token punctuation">:</span>//form<span class="token punctuation">-</span>design<span class="token punctuation">:</span>123456@mongo<span class="token punctuation">-</span>outer.test<span class="token punctuation">-</span>basic<span class="token punctuation">-</span>mongo<span class="token punctuation">-</span>outer<span class="token punctuation">:</span>27017/test<span class="token punctuation">-</span>form<span class="token punctuation">-</span>design
      <span class="token comment" spellcheck="true"># uri: mongodb://127.0.0.1:27017/test-form</span>


  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> testMySQL789
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//mysql<span class="token punctuation">-</span>outer.test<span class="token punctuation">-</span>basic<span class="token punctuation">-</span>mysql<span class="token punctuation">-</span>outer<span class="token punctuation">:</span>3306/FORMDESIGN<span class="token punctuation">?</span>allowMultiQueries=true<span class="token important">&amp;serverTimezone</span>=Asia/Shanghai<span class="token important">&amp;characterEncoding</span>=utf8<span class="token important">&amp;useUnicode</span>=true<span class="token important">&amp;useSSL</span>=false
    <span class="token key atrule">druid</span><span class="token punctuation">:</span>
      <span class="token key atrule">initial-size</span><span class="token punctuation">:</span> <span class="token number">8</span>
      <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">8</span>
      <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">50</span>
      <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token number">60000</span>
      <span class="token key atrule">time-between-eviction-runs-millis</span><span class="token punctuation">:</span> <span class="token number">60000</span>
      <span class="token key atrule">min-evictable-idle-time-millis</span><span class="token punctuation">:</span> <span class="token number">300000</span>
      <span class="token key atrule">validationQuery</span><span class="token punctuation">:</span> select 'x'
      <span class="token key atrule">test-while-idle</span><span class="token punctuation">:</span> <span class="token boolean important">true  </span>
      <span class="token key atrule">test-on-borrow</span><span class="token punctuation">:</span> <span class="token boolean important">false  </span>
      <span class="token key atrule">test-on-return</span><span class="token punctuation">:</span> <span class="token boolean important">false  </span>
      <span class="token key atrule">multi-statement-allow</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">filters</span><span class="token punctuation">:</span> config<span class="token punctuation">,</span>stat  
      <span class="token key atrule">poolPreparedStatements</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">maxPoolPreparedStatementPerConnectionSize</span><span class="token punctuation">:</span> <span class="token number">20</span>
      <span class="token key atrule">maxOpenPreparedStatements</span><span class="token punctuation">:</span> <span class="token number">20</span>
      <span class="token key atrule">web-stat-filter</span><span class="token punctuation">:</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">url-pattern</span><span class="token punctuation">:</span> /*
        <span class="token key atrule">exclusions</span><span class="token punctuation">:</span> /druid/*<span class="token punctuation">,</span>*.js<span class="token punctuation">,</span>*.gif<span class="token punctuation">,</span>*.jpg<span class="token punctuation">,</span>*.bmp<span class="token punctuation">,</span>*.png<span class="token punctuation">,</span>*.css<span class="token punctuation">,</span>*.ico
        <span class="token key atrule">session-stat-enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">session-stat-max-count</span><span class="token punctuation">:</span> <span class="token number">10</span>
      <span class="token key atrule">stat-view-servlet</span><span class="token punctuation">:</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">url-pattern</span><span class="token punctuation">:</span> /druid/*
        <span class="token key atrule">reset-enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token key atrule">login-username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">login-password</span><span class="token punctuation">:</span> testMySQL789

      <span class="token key atrule">filter</span><span class="token punctuation">:</span>
        <span class="token key atrule">wall</span><span class="token punctuation">:</span>
          <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true </span>
          <span class="token key atrule">db-type</span><span class="token punctuation">:</span> mysql
          <span class="token key atrule">config</span><span class="token punctuation">:</span>
            <span class="token key atrule">alter-table-allow</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">truncate-allow</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token key atrule">drop-table-allow</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">multi-statement-allow</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">none-base-statement-allow</span><span class="token punctuation">:</span> <span class="token boolean important">false </span>
            <span class="token key atrule">update-where-none-check</span><span class="token punctuation">:</span> <span class="token boolean important">true </span>
            <span class="token key atrule">select-into-outfile-allow</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token key atrule">metadata-allow</span><span class="token punctuation">:</span> <span class="token boolean important">true </span>
          <span class="token key atrule">log-violation</span><span class="token punctuation">:</span> <span class="token boolean important">true </span>
          <span class="token key atrule">throw-exception</span><span class="token punctuation">:</span> <span class="token boolean important">true </span>
  <span class="token key atrule">cache</span><span class="token punctuation">:</span>
    <span class="token key atrule">caffeine</span><span class="token punctuation">:</span>
      <span class="token key atrule">spec</span><span class="token punctuation">:</span> initialCapacity=50<span class="token punctuation">,</span>maximumSize=500<span class="token punctuation">,</span>expireAfterAccess=5s<span class="token punctuation">,</span>expireAfterWrite=10s<span class="token punctuation">,</span>refreshAfterWrite=5s


  <span class="token key atrule">redis</span><span class="token punctuation">:</span> 
    <span class="token key atrule">host</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>outer.test<span class="token punctuation">-</span>basic<span class="token punctuation">-</span>redis<span class="token punctuation">-</span>outer
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token key atrule">password</span><span class="token punctuation">:</span> test@redis160
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">60000</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">2</span>
    <span class="token key atrule">lettuce</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">8</span>
        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token number">-1</span>
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">8</span>
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span>

    <span class="token key atrule">jedis</span><span class="token punctuation">:</span>
      <span class="token key atrule">pool</span><span class="token punctuation">:</span>
        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">8</span>
        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token number">-1</span>
        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">8</span>
        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span>

<span class="token key atrule">eureka</span><span class="token punctuation">:</span>
  <span class="token key atrule">instance</span><span class="token punctuation">:</span>
    <span class="token key atrule">prefer-ip-address</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">instance-id</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.application.name<span class="token punctuation">}</span>@$<span class="token punctuation">{</span>spring.cloud.client.ip<span class="token punctuation">-</span>address<span class="token punctuation">}</span><span class="token punctuation">:</span>$<span class="token punctuation">{</span>server.port<span class="token punctuation">}</span>
    <span class="token key atrule">ipAddress</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>spring.cloud.client.ip<span class="token punctuation">-</span>address<span class="token punctuation">}</span>
  <span class="token key atrule">client</span><span class="token punctuation">:</span>
    <span class="token key atrule">service-url</span><span class="token punctuation">:</span>
      <span class="token key atrule">defaultZone</span><span class="token punctuation">:</span> testtp<span class="token punctuation">:</span>//test<span class="token punctuation">:</span>test2019@eureka<span class="token punctuation">-</span>0.eureka.test<span class="token punctuation">-</span>basic<span class="token punctuation">-</span>eureka.svc.cluster.local<span class="token punctuation">:</span>19011/eureka/<span class="token punctuation">,</span>testtp<span class="token punctuation">:</span>//test<span class="token punctuation">:</span>test2019@eureka<span class="token punctuation">-</span>1.eureka.test<span class="token punctuation">-</span>basic<span class="token punctuation">-</span>eureka.svc.cluster.local<span class="token punctuation">:</span>19011/eureka/<span class="token punctuation">,</span>testtp<span class="token punctuation">:</span>//test<span class="token punctuation">:</span>test2019@eureka<span class="token punctuation">-</span>2.eureka.test<span class="token punctuation">-</span>basic<span class="token punctuation">-</span>eureka.svc.cluster.local<span class="token punctuation">:</span>19011/eureka/
      <span class="token comment" spellcheck="true">#defaultZone: testtp://test:test2019@127.0.0.1:19011/eureka/</span>
<span class="token key atrule">swagger</span><span class="token punctuation">:</span>
  <span class="token key atrule">enable</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>


<span class="token key atrule">auth-server</span><span class="token punctuation">:</span> testtp<span class="token punctuation">:</span>//test<span class="token punctuation">-</span>rdp<span class="token punctuation">-</span>uaa

<span class="token key atrule">security</span><span class="token punctuation">:</span>
  <span class="token key atrule">oauth2</span><span class="token punctuation">:</span>
    <span class="token key atrule">client</span><span class="token punctuation">:</span>
      <span class="token key atrule">client-id</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>form<span class="token punctuation">-</span>rdp 
      <span class="token key atrule">client-secret</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>form<span class="token punctuation">-</span>rdp@testdev 
      <span class="token key atrule">access-token-uri</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>auth<span class="token punctuation">-</span>server<span class="token punctuation">}</span>/oauth/token 
      <span class="token key atrule">user-authorization-uri</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>auth<span class="token punctuation">-</span>server<span class="token punctuation">}</span>/oauth/authorize 
    <span class="token key atrule">resource</span><span class="token punctuation">:</span>
      <span class="token key atrule">token-info-uri</span><span class="token punctuation">:</span> $<span class="token punctuation">{</span>auth<span class="token punctuation">-</span>server<span class="token punctuation">}</span>/oauth/check_token 


<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">20041</span>

<span class="token comment" spellcheck="true"># mybatis-plus:</span>
<span class="token comment" spellcheck="true">#   mapper-locations: classpath:mybatis/mapper/*Mapper.xml</span>
<span class="token comment" spellcheck="true">#   configuration:</span>
<span class="token comment" spellcheck="true">#     cache-enabled: true</span>
<span class="token comment" spellcheck="true">#     call-setters-on-nulls: true</span>
<span class="token comment" spellcheck="true">#     log-impl: org.apache.ibatis.logging.stdout.StdOutImpl</span>


<span class="token key atrule">icpcloud</span><span class="token punctuation">:</span>
  <span class="token key atrule">security</span><span class="token punctuation">:</span>
    <span class="token key atrule">resource</span><span class="token punctuation">:</span>
      <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">permitAll</span><span class="token punctuation">:</span>
        <span class="token key atrule">filterPath</span><span class="token punctuation">:</span> /emp/info/**/security
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>这里端口号配置的是20041，那么这时在看该服务的k8s部署文档：</p>
<pre class="line-numbers language-yaml"><code class="language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>form<span class="token punctuation">-</span>design<span class="token punctuation">-</span>rdp
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>all<span class="token punctuation">-</span>service
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>form<span class="token punctuation">-</span>design<span class="token punctuation">-</span>rdp
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">20040</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> tcp
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">20040</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>form<span class="token punctuation">-</span>design<span class="token punctuation">-</span>rdp
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>form<span class="token punctuation">-</span>design<span class="token punctuation">-</span>rdp
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>all<span class="token punctuation">-</span>service
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">minReadySeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">revisionHistoryLimit</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">strategy</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> RollingUpdate
    <span class="token key atrule">rollingUpdate</span><span class="token punctuation">:</span>
      <span class="token key atrule">maxUnavailable</span><span class="token punctuation">:</span> <span class="token number">0</span>
      <span class="token key atrule">maxSurge</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>form<span class="token punctuation">-</span>design<span class="token punctuation">-</span>rdp
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">app</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>form<span class="token punctuation">-</span>design<span class="token punctuation">-</span>rdp
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">affinity</span><span class="token punctuation">:</span>
        <span class="token key atrule">podAntiAffinity</span><span class="token punctuation">:</span>
          <span class="token key atrule">preferredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">podAffinityTerm</span><span class="token punctuation">:</span>
                <span class="token key atrule">topologyKey</span><span class="token punctuation">:</span> kubernetes.io/hostname
                <span class="token key atrule">labelSelector</span><span class="token punctuation">:</span>
                  <span class="token key atrule">matchExpressions</span><span class="token punctuation">:</span>
                    <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> app
                      <span class="token key atrule">operator</span><span class="token punctuation">:</span> In
                      <span class="token key atrule">values</span><span class="token punctuation">:</span>
                        <span class="token punctuation">-</span> test<span class="token punctuation">-</span>form<span class="token punctuation">-</span>design
                        <span class="token punctuation">-</span> test<span class="token punctuation">-</span>workflow
                        <span class="token punctuation">-</span> test<span class="token punctuation">-</span>form<span class="token punctuation">-</span>design<span class="token punctuation">-</span>rdp
              <span class="token key atrule">weigtest</span><span class="token punctuation">:</span> <span class="token number">1</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> form<span class="token punctuation">-</span>design<span class="token punctuation">-</span>rdp
          <span class="token key atrule">image</span><span class="token punctuation">:</span> 10.0.88.159<span class="token punctuation">:</span>5000/formdesign<span class="token punctuation">-</span>rdp<span class="token punctuation">-</span>develop<span class="token punctuation">:</span>$BUILD_NUMBER
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
          <span class="token key atrule">lifecycle</span><span class="token punctuation">:</span>
            <span class="token key atrule">preStop</span><span class="token punctuation">:</span>
              <span class="token key atrule">testtpGet</span><span class="token punctuation">:</span>
                <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">20040</span>
                <span class="token key atrule">path</span><span class="token punctuation">:</span> /spring/shutdown
          <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
            <span class="token key atrule">testtpGet</span><span class="token punctuation">:</span>
              <span class="token key atrule">path</span><span class="token punctuation">:</span> /actuator/health
              <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">20040</span>
            <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">180</span>
            <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
            <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
            <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span>
            <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">5</span>
          <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
            <span class="token key atrule">testtpGet</span><span class="token punctuation">:</span>
              <span class="token key atrule">path</span><span class="token punctuation">:</span> /actuator/health
              <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">20040</span>
            <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">180</span>
            <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
            <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
            <span class="token key atrule">successThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span>
            <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">5</span>
          <span class="token key atrule">resources</span><span class="token punctuation">:</span>
            <span class="token key atrule">requests</span><span class="token punctuation">:</span>
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 350Mi
            <span class="token key atrule">limits</span><span class="token punctuation">:</span>
              <span class="token key atrule">memory</span><span class="token punctuation">:</span> 1.5Gi
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">20040</span>
          <span class="token key atrule">env</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> IP_ADDR
              <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
                <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>
                  <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> status.podIP
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> NACOS_IP
              <span class="token key atrule">value</span><span class="token punctuation">:</span> 192.168.229.211<span class="token punctuation">:</span><span class="token number">18848</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> NACOS_NAMESPACE
              <span class="token key atrule">value</span><span class="token punctuation">:</span> d79ba2e9<span class="token punctuation">-</span>da64<span class="token punctuation">-</span>40e8<span class="token punctuation">-</span>9dcd<span class="token punctuation">-</span>92cc24bcaf4e
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SKYWALKING_NAMESPACE
              <span class="token key atrule">value</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>k8s<span class="token punctuation">-</span>develop
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SKYWALKING_TARGET_SERVICE_NAME
              <span class="token key atrule">value</span><span class="token punctuation">:</span> test<span class="token punctuation">-</span>form<span class="token punctuation">-</span>design<span class="token punctuation">-</span>rdp
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> SKYWALKING_IP_PORT
              <span class="token key atrule">value</span><span class="token punctuation">:</span> 10.0.88.163<span class="token punctuation">:</span><span class="token number">11800</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CHANNEL
              <span class="token key atrule">value</span><span class="token punctuation">:</span> standalone
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>此处端口号为20040，这时候两个位置并不统一，导致了访问出现问题，服务上线后又迅速被干掉了。</p>
<p>解决方式：固定端口号信息，以配置文件为准，进行修改即可！</p>
<h2 id="关于服务器内核自动升级问题的解决"><a href="#关于服务器内核自动升级问题的解决" class="headerlink" title="关于服务器内核自动升级问题的解决"></a>关于服务器内核自动升级问题的解决</h2><p>由于部分机器进行了</p>
<pre><code>sudo yum update
</code></pre><p>操作，导致内核信息进行了升级，导致有一些机器在启动的时候出现了黑屏和无法启动的情况。</p>
<p>由于在启动时，默认选择了新升级的内核进行了启动，导致报错。如下：</p>
<p><img src="%E6%96%B0%E5%86%85%E6%A0%B8%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%99.png" alt></p>
<p>目前可用的稳定版内核为：3.10.0-1062.12.1.el7.x86_64，或者低于该版本的内核信息。</p>
<p>以192.168.229.221机器为例进行查看和修改，首先登陆192.168.229.221，查看已安装的内核信息：</p>
<pre><code>$ sudo rpm -qa |grep kernel
kernel-tools-libs-3.10.0-1127.10.1.el7.x86_64
kernel-tools-3.10.0-1127.10.1.el7.x86_64
abrt-addon-kerneloops-2.1.11-57.el7.centos.x86_64
kernel-3.10.0-1127.10.1.el7.x86_64
kernel-3.10.0-862.el7.x86_64
kernel-3.10.0-1062.12.1.el7.x86_64

$ sudo rpm -e kernel.x86_64
error: &quot;kernel.x86_64&quot; specifies multiple packages:
  kernel-3.10.0-862.el7.x86_64
  kernel-3.10.0-1062.12.1.el7.x86_64
  kernel-3.10.0-1127.10.1.el7.x86_64
</code></pre><p>然后查看系统可用内核，查看启动时可选择的内核信息：</p>
<pre><code>$ sudo cat /boot/grub2/grub.cfg |grep menuentry
if [ x&quot;${feature_menuentry_id}&quot; = xy ]; then
  menuentry_id_option=&quot;--id&quot;
  menuentry_id_option=&quot;&quot;
export menuentry_id_option
menuentry &#39;CentOS Linux (3.10.0-1127.10.1.el7.x86_64) 7 (Core)&#39; --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option &#39;gnulinux-3.10.0-862.el7.x86_64-advanced-f67e74a9-a85f-48b9-b521-32bdb355ab80&#39; {
menuentry &#39;CentOS Linux (3.10.0-1062.12.1.el7.x86_64) 7 (Core)&#39; --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option &#39;gnulinux-3.10.0-862.el7.x86_64-advanced-f67e74a9-a85f-48b9-b521-32bdb355ab80&#39; {
menuentry &#39;CentOS Linux (3.10.0-862.el7.x86_64) 7 (Core)&#39; --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option &#39;gnulinux-3.10.0-862.el7.x86_64-advanced-f67e74a9-a85f-48b9-b521-32bdb355ab80&#39; {
menuentry &#39;CentOS Linux (0-rescue-ffe45569e61149c0a79c77c7b38c8e33) 7 (Core)&#39; --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option &#39;gnulinux-0-rescue-ffe45569e61149c0a79c77c7b38c8e33-advanced-f67e74a9-a85f-48b9-b521-32bdb355ab80&#39; {
</code></pre><p>下一步查看当前内核信息：</p>
<pre><code>$ uname -a
Linux dev-k8s-node01 3.10.0-1127.10.1.el7.x86_64 #1 SMP Wed Jun 3 14:28:03 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
</code></pre><p>目前默认的就是这个3.10.0-1127的内核进行启动的，可能会存在问题，这时候需要修改开机时的默认使用的内核。</p>
<pre><code>$ sudo grub2-set-default  &#39;CentOS Linux (3.10.0-1062.12.1.el7.x86_64) 7 (Core)&#39;

$ sudo grub2-editenv list
saved_entry=CentOS Linux (3.10.0-1062.12.1.el7.x86_64) 7 (Core)</code></pre><p>修改完成后，进行如下操作：</p>
<ol>
<li>删除存在启动问题内核</li>
</ol>
<pre><code>$ sudo rpm -qa | grep kernel
kernel-tools-libs-3.10.0-1127.10.1.el7.x86_64
kernel-tools-3.10.0-1127.10.1.el7.x86_64
abrt-addon-kerneloops-2.1.11-57.el7.centos.x86_64
kernel-3.10.0-1127.10.1.el7.x86_64
kernel-3.10.0-862.el7.x86_64
kernel-3.10.0-1062.12.1.el7.x86_64

$ sudo yum remove kernel-3.10.0-1127.10.1.el7.x86_64
Loaded plugins: fastestmirror, langpacks, versionlock
Skipping the running kernel: kernel-3.10.0-1127.10.1.el7.x86_64
No Packages marked for removal 
</code></pre><p>删除内核时出现上述错误，是因为当前内核正在使用，需要机器进行重启后才能删除。</p>
<ol start="2">
<li>禁用内核自动更新</li>
</ol>
<pre><code>// 复制保留原来的配置文件
$ sudo cp /etc/yum.conf /etc/yum.conf.bak

$ sudo vim /etc/yum.conf
// 在[main]的最后添加 exclude=kernel*
exclude=kernel*

// :wq保存退出
</code></pre>
            </div>
            <hr />

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">写作不易，客官能否打赏一杯奶茶？</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            

    <div class="reprint" id="reprint-statement">
        <p class="reprint-tip">
            <i class="fa fa-exclamation-triangle"></i>&nbsp;&nbsp;
            <span>转载规则</span>
        </p>
        
            <div class="center-align">
                <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                    <img alt=""
                         style="border-width:0"
                         src="https://i.creativecommons.org/l/by/4.0/88x31.png"/>
                </a>
            </div>
            <br/>
            <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text"
                  property="dct:title" rel="dct:type">
                    《k8s中pod运行的问题排查》
                </span> 由
            <a xmlns:cc="http://creativecommons.org/ns#" href="/2020/07/08/k8s-zhong-pod-yun-xing-de-wen-ti-pai-cha/" property="cc:attributionName"
               rel="cc:attributionURL">
                JamesLiAndroid
            </a> 采用
            <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                知识共享署名 4.0 国际许可协议
            </a>进行许可。
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>


        </div>
    </div>

    

    

    

    

    
    <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments input[type=text],
    #vcomments input[type=email],
    #vcomments input[type=url],
    #vcomments textarea {
        box-sizing: border-box;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #42b983;
        font-weight: 500;
        text-decoration: underline;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div id="vcomments" class="card-content"></div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<!-- <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script> -->

<script>
    new Valine({
        el: '#vcomments',
        appId: '',
        appKey: '',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'false' === 'true',
        avatar: 'wavatar',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '如果你没有GitHub账号，还可以在这里评论啦！'
    });
</script>

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/07/09/linux-xia-bu-tong-jdk-ban-ben-gong-cun-wen-ti/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/5.jpg" class="responsive-img" alt="Linux下不同jdk版本共存问题">
                        
                        <span class="card-title">Linux下不同jdk版本共存问题</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Linux下不同jdk版本共存问题问题场景ElasticSearch7.6.2的安装需要java11支持，而目前服务器安装的是java8（jdk1.8），而且es安装在另一个用户下，独自运行。
而且es7.6在java8环境下无法进行启动！
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2020-07-09
                        </span>
                        <span class="publish-author">
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/07/02/jenkins-can-shu-hua-gou-jian-shi-jian-dong-tai-pei-zhi-k8s-bu-shu-wen-jian/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/9.jpg" class="responsive-img" alt="jenkins参数化构建实践--动态配置k8s部署文件">
                        
                        <span class="card-title">jenkins参数化构建实践--动态配置k8s部署文件</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            jenkins参数化构建实践–动态配置k8s部署文件使用插件利用jenkins中的Build With Parameters Plugin插件进行构建。
后端参数化构建设置

配置文件的变更



以test-instance-utils项
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2020-07-02
                            </span>
                        <span class="publish-author">
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 时代与猫的脚步<br />'
            + '作者: JamesLiAndroid<br />'
            + '链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。感谢您的支持。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () { bodyElement.removeChild(newdiv); }, 200);
    });
</script>

    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\(', '\)']]}
    });
</script>

    <footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            &copy; 2019 WeiYang. All Rights Reserved.
            <a href="http://www.beian.miit.gov.cn">鲁ICP备17011350号</a>
            
            &nbsp;<i class="fa fa-area-chart"></i>&nbsp;站点总字数:&nbsp;
            <span class="white-color">291.1k</span>
            

            <br>
            <span id="sitetime"></span>

            
            
        </div>
        <div class="col s12 m4 l4 social-link ">
    <a href="https://github.com/JamesLiAndroid" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:lsy1234567@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="https://zhihu.com/people/li-tian-90-66" class="tooltipped" target="_blank" data-tooltip="访问我的知乎" data-position="top" data-delay="50">
        <i class="fa fa-inverse">知</i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
</div>
    </div>
</footer>

<div class="progress-bar"></div>

<!-- 不蒜子计数初始值纠正 -->
<script>
    $(document).ready(function () {

        var int = setInterval(fixCount, 50);
        var pvcountOffset = 80000;
        var uvcountOffset = 20000;

        function fixCount() {
            if (document.getElementById("busuanzi_container_site_pv").style.display != "none") {
                $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + pvcountOffset);
                clearInterval(int);
            }
            if ($("#busuanzi_container_site_pv").css("display") != "none") {
                $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + uvcountOffset); // 加上初始数据 
                clearInterval(int);
            }
        }
    });
</script>

<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();
        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */
        var t1 = Date.UTC(2020, 01, 28, 00, 00, 00); //北京时间2018-2-13 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "本站已运行 " + diffYears + " 年 " + diffDays + " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
    }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
</script>

    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <script type="text/javascript"> var OriginTitile = document.title, st; document.addEventListener("visibilitychange", function () { document.hidden ? (document.title = "Σ(っ °Д °;)っ喔哟，崩溃啦！", clearTimeout(st)) : (document.title = "φ(゜▽゜*)♪咦，又好了！", st = setTimeout(function () { document.title = OriginTitile }, 3e3)) })
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->



    
    <script src="/libs/others/clicklove.js"></script>
    

    

    <!-- 雪花特效 -->
    

</body>

</html>