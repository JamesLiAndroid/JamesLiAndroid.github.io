<!DOCTYPE HTML>
<html lang="zh-CN">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="Linux日常运维操作, Java Android Python DevOps JamesLiAndroid 小李 运维 ">
    <meta name="baidu-site-verification" content>
    <meta name="google-site-verification" content>
    <meta name="360-site-verification" content>
    <meta name="description" content="Linux系统初始化以及部署系统版本
系统版本：CentOS 7.6
内核版本：3.10.0-957.27.2.el7.x86_64
虚拟机信息：Vmware Exsi 6.5

当前进度
未完成消息队列的编写
未完成Redis集群搭建的编">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Linux日常运维操作 | 时代与猫的脚步</title>
    <link rel="icon" type="image/png" href="/favicon.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?46e79e71af0709a5b9106bf20cecc493";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body>

    <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/medias/logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">时代与猫的脚步</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tags" class="waves-effect waves-light">
            
            <span>标签</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <span>分类</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <span>关于</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/contact" class="waves-effect waves-light">
            
            <span>留言板</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/medias/logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">时代与猫的脚步</div>
        <div class="logo-desc">
            
            山东理工大学 | 电子信息工程
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-link"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="/tags" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-link"></i>
                
                标签
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-link"></i>
                
                分类
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-link"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-link"></i>
                
                关于
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-link"></i>
                
                友情链接
            </a>
        </li>
        
        <li>
            <a href="/contact" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-link"></i>
                
                留言板
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/JamesLiAndroid" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/JamesLiAndroid" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

    
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('/medias/featureimages/25.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        Linux日常运维操作
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                        <a href="/tags/DevOps-Linux-运维手册/" target="_blank">
                            <span class="chip bg-color">DevOps, Linux 运维手册</span>
                        </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                        <a href="/categories/DevOps/" class="post-category" target="_blank">
                            DevOps
                        </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2020-01-31
                </div>

                <div class="post-author info-break-policy">
                    <i class="fa fa-user-o fa-fw"></i>作者:&nbsp;&nbsp;
                    
                    JamesLiAndroid
                    
                </div>

                
                
                <div class="info-break-policy">
                    <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                    10.8k
                </div>
                

                
                <div class="info-break-policy">
                    <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                    49 分
                </div>
                
                

                
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="Linux系统初始化以及部署"><a href="#Linux系统初始化以及部署" class="headerlink" title="Linux系统初始化以及部署"></a>Linux系统初始化以及部署</h1><h2 id="系统版本"><a href="#系统版本" class="headerlink" title="系统版本"></a>系统版本</h2><ol>
<li>系统版本：CentOS 7.6</li>
<li>内核版本：3.10.0-957.27.2.el7.x86_64</li>
<li>虚拟机信息：Vmware Exsi 6.5</li>
</ol>
<h2 id="当前进度"><a href="#当前进度" class="headerlink" title="当前进度"></a>当前进度</h2><ul>
<li>未完成消息队列的编写</li>
<li>未完成Redis集群搭建的编写</li>
<li>未完成mongodb集群搭建的编写</li>
</ul>
<h2 id="系统初始化"><a href="#系统初始化" class="headerlink" title="系统初始化"></a>系统初始化</h2><p>首先进行镜像的安装，使用CentOS 7.6的镜像进行安装，采用最小化安装的方式（无图形化界面、不联网更新）。安装完成后进行系统初始化之前，确保机器可以配置外网连接，如果需要内网使用，请选择基本系统安装方式（安装方式说明见附录）。</p>
<p>注意：</p>
<pre><code>1. “#” 代表在root用户下执行命令，“$” 代表在常规用户下执行命令。

2. 如果处于“$”常规用户下，可以使用sudo命令进行提权操作。

3. 所有命令使用man查看帮助，例如 man ls 查看ls命令的使用方式。某些命令还可以使用--help项查看帮助信息，例如git --help，查看git命令的相关使用方式。

4. 文中所有的服务器ip均为假ip信息，需要根据自己的需要进行更换。</code></pre><h3 id="0-0-查看基础配置信息"><a href="#0-0-查看基础配置信息" class="headerlink" title="0.0 查看基础配置信息"></a>0.0 查看基础配置信息</h3><ul>
<li><p>cpu查看</p>
</li>
<li><p>内存查看 </p>
</li>
<li><p>硬盘查看</p>
</li>
<li><p>系统信息获取</p>
</li>
</ul>
<h3 id="0-网络配置"><a href="#0-网络配置" class="headerlink" title="0. 网络配置"></a>0. 网络配置</h3><ul>
<li><p>设置公网ip或者是内网可访问的地址</p>
<pre><code>  // 1. 先查看机器的网卡信息
  # ip addr
  1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
  ...
  2: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
  ...

  // 2. 修改网卡的配置文件，对应上方的ens-192
  # vi /etc/sysconfig/network-scripts/ifcfg-ens192 
  // 按照以下配置修改
  TYPE=Ethernet
  PROXY_METHOD=none
  BROWSER_ONLY=no
  BOOTPROTO=static                // 配置为静态ip
  DEFROUTE=yes
  IPV4_FAILURE_FATAL=no
  IPV6INIT=yes
  IPV6_AUTOCONF=yes
  IPV6_DEFROUTE=yes
  IPV6_FAILURE_FATAL=no
  IPV6_ADDR_GEN_MODE=stable-privacy
  NAME=ens192
  UUID=1df6ac77-3294-42c8-b2af-fd81ce6bb5fc
  DEVICE=ens192
  ONBOOT=yes                      // 配置开机启动
  IPADDR=10.0.11.156              // 配置ip地址
  NETMASK=255.255.255.0           // 配置子网掩码
  GATEWAY=10.0.11.254             // 配置网关
  DNS=202.102.152.3               // 配置DNS信息
  ZONE=public

  // 3. 重启网络服务
  # systemctl restart network

  // 4. 查看修改结果
  # ip addr
  1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
  ...
  2: ens192: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000
  link/ether 00:0c:29:73:f8:de brd ff:ff:ff:ff:ff:ff
  inet 10.0.11.156/24 brd 10.0.11.255 scope global noprefixroute ens192
  valid_lft forever preferred_lft forever

  // 此时表示网络设置完成</code></pre></li>
</ul>
<p>如果网络依旧不能使用，例如ping baidu.com不通，但是ping 114.114.114.114成功，这时需要设置DNS服务器地址。</p>
<pre><code>    // 编辑/etc/resolv.conf，如果是新安装的机器，这个文件的内容可能为空
    # vim /etc/resolv.conf

    // 添加下面的内容：
    nameserver 114.114.114.114 // (电信的DNS)

    nameserver 8.8.8.8 //（googel的DNS）

    nameserver 1.1.1.1

    nameserver 223.5.5.5 // 阿里的公共DNS
    nameserver 223.6.6.6

    nameserver 202.102.152.3 // 山东网通的dns

    // :wq保存文件

    // 重启network服务
    # systemctl restart network</code></pre><h3 id="1-软件源配置"><a href="#1-软件源配置" class="headerlink" title="1. 软件源配置"></a>1. 软件源配置</h3><ul>
<li><p>更新源</p>
<pre><code>  // 0. 转到软件路径下
  # cd /etc/yum.repos.d/

  // 1. 备份一下当前的repo文件
  # mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.bak

  // 2. 下载yum源，目前这里使用163的
  # wget http://mirrors.163.com/.help/CentOS7-Base-163.repo

  // 可以使用aliyun的yum源，不需要执行下面修改名称的操作
  # wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo

  // 3. 执行替换操作
  # mv CentOS7-Base-163.repo CentOS7-Base.repo

  // 4. 将服务器上的软件包信息 现在本地缓存,以提高 搜索 安装软件的速度
  # yum makecache

  // 等待更新完成即可进行更新系统操作

  // 5. 安装epel源---常用工具安装必备
  # yum install -y epel-release

  // 6. 安装sysstat---排查工具
  # yum install -y sysstat

  // 7. 安装httpd---添加压测命令ab
  # yum install httpd-tools -y</code></pre></li>
<li><p>更新系统</p>
<pre><code>  // 使用update命令更新
  // 总的来说更新（update）和升级（upgrade）是相同的，除了事实上 升级 = 更新 + 更新时进行废弃处理。
  # yum update &amp;&amp; yum upgrade

  // 注意：为了避免更新内核造成启动不稳定的问题，update时尽量避免更新内核相关组件，如下：
  # yum update --exclude=kernel*

  // 或者直接修改/etc/yum.conf文件，追加
  # cat /etc/yum.conf &gt;&gt; EOF &lt; 
  exclude=kernel*
  exclude=centos-release*</code></pre></li>
<li><p>包管理工具常用命令</p>
<pre><code>  // 搜索软件包
  # yum search 软件包   
  // 安装软件包
  # yum install 软件包  
  // 移除软件包
  # yum remove 软件包
  //更新系统
  # yum update  </code></pre></li>
<li><p>常用工具安装</p>
<pre><code>  // 1. 安装 Wget
  # yum install -y wget

  // 2. 安装git
  # yum install -y git

  // 3. 安装unzip
  # yum install -y unzip

  // 4. 网络工具箱
  # yum install -y net-tools 

  // 5. curl工具
  # yum install -y curl

  // 6. vim编辑器，比vi工具更现代
  # yum install -y vim 

  // 7. telnet工具
  # yum install -y telnet 

  // 8. 安装pstree工具集
  // psmisc包含三个帮助管理/proc目录的程序。
  // fuser 显示使用指定文件或者文件系统的进程的PID。
  // killall 杀死某个名字的进程，它向运行指定命令的所有进程发出信号。
  // pstree 树型显示当前运行的进程。
  # yum install -y psmisc

  // 9. 安装更直观的htop来替代top命令
  # yum install -y htop

  // 10. 安装sshpass用于shell脚本中传递密码信息
  # yum install -y sshpass

  // 11. 安装tree实现文件夹下批量展示
  # yum install -y tree

  // 12. 安装jq可以对json数据进行分片、过滤、映射和转换，
  # yum install -y jq

  // 13. 安装yum工具
  # yum install -y yum-utils

  // 14. jenkins所在机器需要安装
  # yum install -y autoconf automake libtool nasm libpng libpng-devel

  // 15. patch工具
  # yum install -y patch gcc pcre pcre-devel zlib zlib-devel openssl-devel openssl</code></pre><p>  注意：“-y”代表同意安装该程序，无需在安装时确定</p>
<p>  一条命令安装如下：</p>
<pre><code>  # yum install -y wget git unzip net-tools curl vim telnet psmisc  tree sshpass jq yum-utils</code></pre></li>
</ul>
<h3 id="2-用户配置"><a href="#2-用户配置" class="headerlink" title="2. 用户配置"></a>2. 用户配置</h3><ul>
<li><p>添加用户</p>
<pre><code>  // 创建用户的命令, -m表示创建home目录信息，centos表示常规使用的用户
  # useradd -m centos 
  // 设定密码
  # passwd centos

  // 创建用户的命令, -m表示创建home目录信息，ftpuser表示常规使用的用户
  # useradd -m ftpuser 
  // 设定密码
  # passwd ftpuser</code></pre></li>
</ul>
<ul>
<li><p>用户权限（非测试环境不允许启用root权限）</p>
<pre><code>  // 使用vim修改文件
  # vim /etc/sudoers

  ##
  ## The COMMANDS section may have other options added to it.
  ##
  ## Allow root to run any commands anywhere
  root    ALL=(ALL)       ALL
  #centos  ALL=NOPASSWD:/usr/libexec/openssh/sftp-server
  centos  ALL=(ALL)       ALL    # 添加该行信息</code></pre></li>
<li><p>修改主机名称</p>
<pre><code>  // 变更服务器hostname
  # hostnamectl set-hostname your-own-machine-name</code></pre></li>
<li><p><strong>注意</strong>：一定不要在生产环境启用root权限，原则上不允许在线上环境切换到root用户执行命令。</p>
</li>
</ul>
<h3 id="3-时钟同步（可访问外网的情况下启用）"><a href="#3-时钟同步（可访问外网的情况下启用）" class="headerlink" title="3. 时钟同步（可访问外网的情况下启用）"></a>3. 时钟同步（可访问外网的情况下启用）</h3><p>使用ntpdate+crontab来完成时钟同步。</p>
<pre><code>    // 0. 查看时钟是否正确
    $ date

    // 1. 首先安装ntpdate
    # yum install -y ntpdate

    // 2. 调用ntpdate命令进行时钟修正，确保该命令可用
    # ntpdate -u pool.ntp.org

    // 3. 最后，集成定时任务
    # crontab -e

    // 类vim编辑页面，输入i添加下面的内容，表示每10分钟执行一次定时任务，同步时钟信息。
    */10 * * * * /usr/sbin/ntpdate pool.ntp.org &gt; /dev/null 2&gt;&amp;1

    // 点击Esc按钮，退出编辑，输入:wq进行保存。此时定时任务已经设置完成。

    // 4. 重启定时任务服务
    # systemctl restart crond

    // 5. 查看定时任务执行情况，参考下面命令：
    tail -f /var/log/cron</code></pre><p>参考链接：<a href="https://www.cnblogs.com/frankdeng/p/9005691.html" target="_blank" rel="noopener">https://www.cnblogs.com/frankdeng/p/9005691.html</a></p>
<h3 id="4-防火墙设置（默认不允许关闭）"><a href="#4-防火墙设置（默认不允许关闭）" class="headerlink" title="4. 防火墙设置（默认不允许关闭）"></a>4. 防火墙设置（默认不允许关闭）</h3><p>此处的防火墙为CentOS系统默认的防火墙服务firewalld，使用firewall-cmd来进行设置端口的开放和关闭。系统初始使用时，默认只开放21（ftp服务）、22（ssh）、80（http web服务）、443（https）等端口。</p>
<pre><code>    // 1. 首先查看firewalld服务是否已经打开
    # systemctl status firewalld

    // 2. 查看目前已选的区信息
    # firewall-cmd --get-default-zone 

    // 一般已启用的区信息为public

    // 3. 查看目前已经开放的端口信息
    # firewall-cmd --list-all 

    // 或者使用下面的命令

    # firewall-cmd --zone=public --list-ports

    // 4. 设置要开放的端口，--permanent代表永久生效
    # firewall-cmd --zone=public --add-port=5000/tcp --permanent

    // 5. 设置要开放的端口段，例如19000-19999
    # firewall-cmd --zone=public --add-port=4990-4999/tcp --permanent

    // 6. 关闭已经设置的端口
    # firewall-cmd --zone=public --remove-port=5000/tcp --permanent

    // 7. 重新加载，当设置完端口后，使用该命令生效
    # firewall-cmd --reload

    // 8. 重启firewalld服务
    # systemctl restart firewalld

    // 9. 禁用firewalld服务
    # systemctl disable firewalld

    // 10. 启用firewalld服务
    # systemctl start firewalld</code></pre><h3 id="5-ftp服务设置（可选）"><a href="#5-ftp服务设置（可选）" class="headerlink" title="5. ftp服务设置（可选）"></a>5. ftp服务设置（可选）</h3><pre><code>    // 使用yum安装vsftpd
    # yum install -y vsftpd 

    // 启动 FTP 服务
    # systemctl start vsftpd

    // 对ftp服务进行配置，配置信息位于/etc/vsftpd/目录下
    # vim /etc/vsftpd/vsftpd.conf

    // 配置文件中找到下面两行
    // 禁用匿名用户  12 YES 改为NO
    anonymous_enable=NO

    // 禁止切换根目录 101 行 删除#
    chroot_local_user=YES 

    // 更换登录端口
    listen=NO
    listen_port=2231

    // :wq保存配置信息

    // 重启服务
    # systemctl restart vsftpd

    // 防火墙开启2231端口对外访问
    # firewall-cmd --zone=public --add-port=2231/tcp --permanent
    # firewall-cmd --reload

    // 添加ftp用户
    # useradd ftpuser

    // 设置密码，如果需要自己设定请替换引号内的信息
    # echo &quot;testftp&quot; | passwd ftpuser --stdin

    // 限制ftpuser只能通过ftp服务访问
    # usermod -s /sbin/nologin ftpuser

    // 为用户分配主目录
    // /home/ftpuser/ 为主目录, 该目录不可上传文件
    // /home/ftpuser/pub 文件只能上传到该目录下（目前设定的是，直接传输到/home/ftpuser/目录下）


    // 创建目录结构
    # mkdir -p /home/ftpuser/pub

    // 设置访问权限
    # chmod a-w /home/ftpuser &amp;&amp; chmod 777 -R /home/ftpuser/pub

    // 设置为用户主目录
    # usermod -d /home/ftpuser ftpuser

    // 重启下ftp服务
    # systemctl restart vsftpd

这样ftp服务就设置完成了，可以使用[WinSCP](https://winscp.net/eng/docs/lang:chs)登录或者使用[FileZilla](https://filezilla-project.org/)登录。</code></pre><h3 id="6-ssh服务设置"><a href="#6-ssh服务设置" class="headerlink" title="6. ssh服务设置"></a>6. ssh服务设置</h3><pre><code>    // 首先，确保服务器已安装openssh-server，命令如下：

    // 1. 判断ssh服务已安装
    # yum list installed | grep openssh-server
    // 如果有以下输出，说明已经安装相关组件
    openssh-server.x86_64                7.4p1-21.el7                   @base  

    // 2. 若未安装，首先安装openssh-server
    # yum install -y openssh-server

    // 3. 找到sshd的配置文件
    # cd /etc/ssh
    # vim ./sshd_config

    // 3.1 修改登录端口为15555, 允许任意ip远程登录，如果是内网机器，则不要设置任意ip远程登录
    Port 15555

    ListenAddress 0.0.0.0
    ListenAddress ::

    // 3.2 设置不允许root用户远程登录
    PermitRootLogin no

    // 3.3 开启使用用户名密码来作为连接验证
    PasswordAuthentication yes

    // 3.4 加速ssh连接速度
    GSSAPIAuthentication no
    // 如果这句没有需要自己添加，如果被注释请放开注释
    UseDNS no

    // 设置完成后, :wq 退出编辑

    // 4. 重启ssh服务，重启网络，并设置开机启动sshd，依次执行下面的命令
    # systemctl restart sshd
    # systemctl restart network
    # systemctl enable sshd

    // 5. 防火墙开启访问信息
    # firewall-cmd --zone=public --add-port=15555/tcp --permanent
    # firewall-cmd --reload

这样ssh服务就设置完毕了，我们在前面已经创建了**centos**用户，因此在客户机上尝试远程连接服务器。以Windows系统为例，使用[Cmder](https://cmder.net/)作为终端工具。打开Cmder终端工具，输入以下信息：

    ssh -p 15555 centos@10.0.11.11

其中**-p*表示指定端口号，*centos*就是我们在前面设置的用户名，**10.0.11.11*需要替换为你自己的真实ip地址。在出现输入密码的位置，输入用户对应的密码信息，回车即可登录服务器。

另外，在重启sssh服务的时候，可能会报错，如下：

    # systemctl restart sshd
    Job for sshd.service failed because the control process exited with error code. See &quot;systemctl status sshd.service&quot; and &quot;journalctl -xe&quot; for details.

    // 执行后无法启动，查看报错信息

    # journalctl -xe

    error: Bind to port 522 on 0.0.0.0 failed: Permission denied.
    error: Bind to port 522 on :: failed: Permission denied.
    fatal: Cannot bind any address.

    // 当端口设置完成后，需要在selinux设置允许该端口作为ssh的连接端口

    // 首先安装管理工具
    # yum install -y policycoreutils-python

    // 开放该端口使用
    # semanage port -a -t ssh_port_t -p tcp 522

    // 防火墙开启访问信息
    # firewall-cmd --zone=public --add-port=552/tcp --permanent
    # firewall-cmd --reload

上边552代表你在/etc/ssh/sshd_config中设置的端口号。

参考地址：https://wildwolf.name/centos-7-how-to-change-ssh-port/</code></pre><h3 id="7-sshd进程提升优先级"><a href="#7-sshd进程提升优先级" class="headerlink" title="7. sshd进程提升优先级"></a>7. sshd进程提升优先级</h3><p>建议使用 <strong>nice</strong> 命令或者<strong>renice</strong>命令将 sshd 进程的优先级调高，这样当系统内存紧张时，还能勉强登陆服务器进行调试，然后分析故障。操作如下：</p>
<pre><code>// 找到该进程信息，注意查找真正的进程，根据/usr/sbin/sshd -D获取
$ ps -aux | grep sshd
// 展示下面的信息
root      2567  0.0  0.0 158936  5684 ?        Ss   08:34   0:00 sshd: centos [priv]
centos    2601  0.0  0.0 158936  2452 ?        S    08:35   0:00 sshd: centos@pts/0
root      2994  0.0  0.0 158936  5684 ?        Ss   08:51   0:00 sshd: centos [priv]
centos    3000  0.0  0.0 158936  2452 ?        S    08:51   0:00 sshd: centos@pts/1
centos    4474  0.0  0.0 112712   964 pts/1    S+   09:36   0:00 grep --color=auto sshd
root     23773  0.0  0.0 112920   460 ?        Ss   Mar11   0:00 /usr/sbin/sshd -D

// 查看进程优先级
$  ps ax -o pid,nice,comm | grep sshd
 2567   0 sshd
 2601   0 sshd
 2994   0 sshd
 3000   0 sshd
23773   0 sshd

// 修改第一个进程的id信息，将优先级提升到最高
// 修改的是/usr/sbin/sshd -D启动命令所在的进程
$ sudo renice -20 -p 23773

// 查看进程优先级
$  ps ax -o pid,nice,comm | grep sshd
 2567   0 sshd
 2601   0 sshd
 2994   0 sshd
 3000   0 sshd
23773 -20 sshd

// 退出后重新登录，再查看
$ ps aux | grep sshd
root      2567  0.0  0.0 158936  5684 ?        Ss   08:34   0:00 sshd: centos [priv]
centos    2601  0.0  0.0 158936  2452 ?        S    08:35   0:00 sshd: centos@pts/0
root      4944  0.5  0.0 158936  5684 ?        S&lt;s  09:40   0:00 sshd: centos [priv]
centos    4959  0.0  0.0 158936  2300 ?        S&lt;   09:41   0:00 sshd: centos@pts/1
centos    4997  0.0  0.0 112716   960 pts/1    S&lt;+  09:41   0:00 grep --color=auto sshd
root     23773  0.0  0.0 112920   460 ?        S&lt;s  Mar11   0:00 /usr/sbin/sshd -D

$ ps ax -o pid,nice,comm | grep sshd
2567   0 sshd
2601   0 sshd
4944 -20 sshd
4959 -20 sshd
23773 -20 sshd</code></pre><p>可以看到的是sshd进程中，出现<strong>S&lt;s</strong>，”&lt;”代表高优先级进程标志，说明测试成功。</p>
<p>参考链接：</p>
<ul>
<li>关于进程相关命令的说明：<a href="https://www.cnblogs.com/alongdidi/p/linux_process.html" target="_blank" rel="noopener">https://www.cnblogs.com/alongdidi/p/linux_process.html</a></li>
</ul>
<h3 id="8-内核升级和优化（非必选）"><a href="#8-内核升级和优化（非必选）" class="headerlink" title="8.内核升级和优化（非必选）"></a>8.内核升级和优化（非必选）</h3><p>以内核升级到4.19版本为例，进行操作，需要在root用户下操作。</p>
<p>首先更新并重启机器，需要排除内核信息</p>
<pre><code># yum update -y --exclude=kernel* &amp;&amp; reboot
</code></pre><p>在生产环境中必须进行内核升级，如果需要安装docker，强烈建议将CentOS 7的内核版本升级到4.18+。 这里使用4.19版本</p>
<pre><code># cd /root
# wget http://193.49.22.109/elrepo/kernel/el7/x86_64/RPMS/kernel-ml-4.19.12-1.el7.elrepo.x86_64.rpm
# wget http://193.49.22.109/elrepo/kernel/el7/x86_64/RPMS/kernel-ml-devel-4.19.12-1.el7.elrepo.x86_64.rpm
</code></pre><p>可以先下载后再上传到服务器上，如果有多个服务器，可以使用下面的示例命令，传输到各个服务器上。</p>
<pre><code>
// 将内核文件传输到各个机器上

# for i in k8s-master-02 k8s-master-03 k8s-node-01 k8s-node-02; do scp kernel-ml-4.19.12-1.el7.elrepo.x86_64.rpm kernel-ml-devel-4.19.12-1.el7.elrepo.x86_64.rpm $i:/root/ ;done
</code></pre><p>开始安装内核信息，在服务器上执行以下命令，如下：</p>
<pre><code># cd /root/ &amp;&amp; yum localinstall kernel-ml* -y
</code></pre><p>安装完成后，需要更改内核启动顺序，以便启动时自动选择最新的内核版本信息。</p>
<pre><code># grub2-set-default 0 &amp;&amp; grub2-mkconfig -o /etc/grub2.cfg
# grubby --args=&quot;user_namespace.enable=1&quot; --update-kernel=&quot;$(grubby --default-kernel)&quot;
</code></pre><p>最后检查内核版本信息。</p>
<pre><code># grubby --default-kernel
// 输出以下版本信息
/boot/vmlinuz-4.19.12-1.el7.elrepo.x86_64
</code></pre><p>所有节点重启，再检查内核信息。</p>
<h2 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h2><p>前提信息：区分使用原生安装还是docker安装</p>
<ol>
<li><p>基础设施</p>
<ul>
<li><p>JDK安装–OpenJDK、OracleJDK</p>
<p>  首先介绍OracleJDK的安装，生产环境中使用的是OracleJDK，版本为1.8.0_202。预设前提是，已经将OracleJDK的安装包下载完毕了。第一步需要判断服务器上是否安装过jdk，执行下面的命令：</p>
<pre><code>  # yum list installed | grep openjdk</code></pre><p>  如果已经安装过jdk，例如镜像内已经含有openjdk，需要先移除已安装的jdk。执行下面的命令：</p>
<pre><code>  # yum remove java-1.8.0-openjdk</code></pre><p>  第二步，通过ftp的方式将OracleJDK安装文件传入服务器，可以使用图形化工具，例如<a href="https://winscp.net/eng/index.php" target="_blank" rel="noopener">WinSCP</a>、<a href="https://filezilla-project.org/" target="_blank" rel="noopener">FileZilla</a>，这里使用命令行的形式传输，打开Cmder工具，输入以下命令：</p>
<pre><code>  scp -P 15555 jdk-8u202-linux-x64.tar.gz ftpuser@10.0.11.11:/home/ftpuser</code></pre><p>  这样就将OracleJDK的安装包传入到服务器了。第三部开始解压，并创建相关目录。</p>
<pre><code>  // 将安装文件解压
  $ tar -zxvf jdk-8u202-linux-x64.tar.gz
  // 创建安装目录
  $ sudo mkdir /usr/local/java/
  // 将解压后的文件夹拷贝到安装目录
  $ sudo cp -r jdk1.8.0_202/ /usr/local/java/</code></pre><p>  第四步，开始配置环境变量，用vim打开/etc/profile，进行设置</p>
<pre><code>  $ sudo vim /etc/profile

  // 在文档末尾添加
  # JAVA env
  JAVA_HOME=/usr/local/java/
  JRE_HOME=$JAVA_HOME/jre
  CLASS_PATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib
  PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin
  export JAVA_HOME JRE_HOME CLASS_PATH PATH

  // 最后输入:wq保存文档

  // 使环境变量生效
  $ sudo source /etc/profile

  // 添加软链接
  $ sudo ln -s /usr/local/java/jdk1.8.0_202/bin/java /usr/bin/java
  $ sudo ln -s /usr/local/java/jdk1.8.0_202/bin/javac /usr/bin/javac</code></pre><p>  这样OracleJDK就安装完成了，可以执行以下命令进行检查。</p>
<pre><code>  $ java -version
  $ javac -version</code></pre><p>  如果均能输出java的版本信息，说明安装成功。</p>
<p>  如果是要安装openjdk的话，直接使用下面的命令安装即可：</p>
<pre><code>  $ sudo yum install -y java-1.8.0-openjdk.x86_64</code></pre><p>  如果是多版本jdk存在，使用alternatives命令进行管理和切换。<a href="https://blog.csdn.net/waplys/article/details/98478247" target="_blank" rel="noopener">参考下面的链接</a>。</p>
</li>
</ul>
</li>
</ol>
<ul>
<li><p>docker、docker-compose安装</p>
<p>  安装的docker版本为19.0.3，安装的docker-compose版本为1.24.1。依据下面的命令来安装docker：</p>
<pre><code>  // 确定自己服务器的内核版本
  # uname -r</code></pre><p>  确定</p>
<pre><code>  // 更新当前的软件源
  # yum update

  // 卸载旧版本（如果以前安装过旧版本），并清除之前的docker存档(如果需要的话)
  # yum remove docker docker-common docker-selinux docker-engine
  # rm -r /var/lib/docker

  // 安装需要的软件包依赖
  # yum install -y yum-utils \
              device-mapper-persistent-data \
              lvm2

  // 添加repo信息
  # yum-config-manager \
          --add-repo \
          https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo

  // 更新软件源缓存
  # yum makecache fast

  // 查找软件源中的docker版本
  # yum list docker-ce.x86_64 --showduplicates | sort -r

  // 安装最新的稳定版本的docker或者安装指定版本的docker，执行一条命令即可
  # yum install -y docker-ce

  // 配置docker服务以及设置开机启动
  # systemctl start docker
  # systemctl enable docker

  // 拉取hello-world镜像测试docker命令是否可用
  # docker pull hello-world
  # docker run hello-world</code></pre><p>  如果能够正常输出hello-world，则说明docker安装成功。</p>
<p>  安装完成后，需要配置当前用户在不需要root权限的情况下可以正常使用docker的各项命令。例如我们添加centos用户到docker可执行的组中。配置命令如下：</p>
<pre><code>  $ sudo groupadd docker
  $ sudo usermod -aG docker ${USER}
  (或者执行 sudo gpasswd -a ${USER} docker)
  $ sudo systemctl restart docker

  // 建议这时候退出重新登录下，断开ssh连接或者重启下服务器
  // 否则可能在执行docker pull命令的时候报错：Got permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Post http://%2Fvar%2Frun%2Fdocker.sock/v1.40/images/create?fromImage=hello-world&amp;tag=latest: dial unix /var/run/docker.sock: connect: permission denied
  # reboot

  // 这时候也可以尝试，退出ssh，重新使用ssh登录服务器

  // 如果不重启服务器，可以执行下面的命令解决
  $ sudo setfacl --modify user:centos:rw /var/run/docker.sock
  // 更新用户组
  $ newgrp docker</code></pre><p>  这样docker就全部安装完成了。可以在用户centos环境下，测试</p>
<pre><code>  $ docker run hello-world</code></pre><p>  如果可以正常输出hello-world，则说明成功。</p>
<p>  另外，可能因为某些原因无意间执行了yum update或者apt-get -y upgrade;导致Docker版本升级。为了避免此类问题发生，建议在安装好Docker后对Docker软件进行锁定，防止Docker意外更新。</p>
</li>
</ul>
<pre><code>    // 安装yum-plugin-versionlock插件
    # yum install yum-plugin-versionlock -y

    // 锁定软件包
    # yum versionlock add docker-ce docker-ce-cli

    // 查看已锁定的软件包
    # yum versionlock list

    // 解锁指定的软件包
    # yum versionlock delete &lt;软件包名称&gt;

    // 解锁所有的软件包
    # yum versionlock clear

需要注意的是，centos系统的内核版本也尽可能进行锁定，防止yum update执行时，被更新。

最后，安装docker-compose，确保前面已经安装好docker了！

    $ sudo curl -L https://github.com/docker/compose/releases/download/1.24.1/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose

    $ sudo chmod +x /usr/local/bin/docker-compose   

    $ sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose</code></pre><ol start="2">
<li>数据库</li>
</ol>
<ul>
<li><p>MySQL安装</p>
<p>  MySQL版本选择5.7.28。分别演示使用rpm安装和docker安装。安装之前，首先需要检查系统中是否存在MariaDB，并删除MariaDB。</p>
<pre><code>  # yum list installed | grep mariadb
  mariadb-libs-x86_64                  ........................................

  // 删除MariaDB
  # yum remove -y mariadb*</code></pre><p>  由于是测试环境，所以先使用docker安装MySQL镜像。</p>
<pre><code>  // 拉取docker镜像
  $ docker pull mysql:5.7.28

  // 启动docker镜像
  $ docker run --restart=always --name mysql5.7 -v /data/mysql5.7-data:/var/lib/mysql -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456  -d mysql:5.7.28</code></pre><p>  当MySQL的docker镜像启动后，登录的用户名默认为root，密码设定为123456。这样启动后，需要打开3306端口，允许外部连接。执行如下：</p>
<pre><code>  # firewall-cmd --zone=public --add-port=15555/tcp --permanent
  # firewall-cmd --reload</code></pre><p>  这样就可以通过<a href="https://www.navicat.com.cn/" target="_blank" rel="noopener">Navicat</a>等工具访问MySQL数据库了。</p>
<p>  如果选择使用软件源的方式安装，需要进行以下操作：</p>
<pre><code>  // 下载MySQL的YUM源
  $ wget https://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm

  // 安装 MySQL 的 YUM 源
  #  rpm -ivh mysql57-community-release-el7-11.noarch.rpm

  // 检查 MySQL 的 YUM 源是否安装成功
  # yum repolist enabled | grep &quot;mysql.*-community.*&quot;

  // 加入缓存信息
  # yum makecache fast

  // 如果结果中出现mysql57-community/x86_64的信息，说明安装成功

  // 查看MySQL版本
  # yum repolist all | grep mysql

  // 安装MySQL，这样安装并不是安装5.7.25版本，有可能是5.7.31这样的版本
  # yum install -y mysql-community-server 

  // 启动MySQL服务
  # systemctl start mysqld

  // 远程访问 MySQL，需要开放 3306 端口：
  # firewall-cmd --permanent --zone=public --add-port=3306/tcp
  # firewall-cmd --permanent --zone=public --add-port=3306/udp
  # firewall-cmd --reload</code></pre><p>  由此MySQL就安装完成了，这时候需要对MySQL进行连接。</p>
<pre><code>  $ mysql -u root -p </code></pre></li>
</ul>
<p>注意事项:</p>
<ol start="0">
<li>关于MySQL在安装后修改初始化密码出现的问题解决：</li>
</ol>
<pre><code>$ mysql -u root -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 4
Server version: 5.7.25

Copyright (c) 2000, 2019, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type &#39;help;&#39; or &#39;\h&#39; for help. Type &#39;\c&#39; to clear the current input statement.

mysql&gt; UPDATE mysql.user SET authentication_string=PASSWORD(&#39;htMySQL789&#39;) where USER=&#39;root&#39;;
ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.
mysql&gt; show databases;
ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.
mysql&gt; ALTER USER USER() IDENTIFIED BY &#39;htMySQL789&#39;;
ERROR 1819 (HY000): Your password does not satisfy the current policy requirements
mysql&gt; SHOW VARIABLES LIKE &#39;validate_password%&#39;;
ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.
mysql&gt; set global validate_password_policy=LOW;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; ALTER USER USER() IDENTIFIED BY &#39;htMySQL789&#39;;
Query OK, 0 rows affected (0.00 sec)

mysql&gt; exit
Bye
</code></pre><ol>
<li><p>针对rpm+yum安装，刚安装的 MySQL 是没有密码的，这时如果出现：</p>
<p> ERROR 1045 (28000): Access denied for user ‘root’@’localhost’ (using password: NO)，解决如下：</p>
<pre><code> // ① 停止 MySQL 服务
 # systemctl stop mysqld 

 // ② 以不检查权限的方式启动 MySQL
 # mysqld --user=root --skip-grant-tables &amp;

 // ③ 再次输入 
 # mysql -u root 或者 mysql

 // ④ 更新密码：
 // MySQL 5.7 以下版本：
 mysql&gt; UPDATE mysql.user SET Password=PASSWORD(&#39;123456&#39;) where USER=&#39;root&#39;;

 // MySQL 5.7 版本：
 mysql&gt; UPDATE mysql.user SET authentication_string=PASSWORD(&#39;123456&#39;) where USER=&#39;root&#39;;

 // ⑤ 刷新，使之前的修改生效：
 mysql&gt; flush privileges;

 // ⑥ 退出：
 mysql&gt; exit;</code></pre></li>
</ol>
<p>设置完之后，输入 mysql -u root -p，这时输入刚设置的密码，就可以登进数据库了。</p>
<ol start="2">
<li>针对rpm+yum安装，需要设置允许远程访问</li>
</ol>
<p>默认情况下 MySQL 是不允许远程连接的，所以在 Java 项目或者 MySQLWorkbench 等数据库连接工具连接服务器上的 MySQL 服务的时候会报 “Host ‘x.x.x.x’ is not allowed to connect to this MySQL server”。可以通过下面的设置解决。详细可以参考之前写的一篇文章 XXX is not allowed to connect to this MySQL server。</p>
<pre><code>// 授权操作, &#39;0&#39;需要改为之前设置的MySQL密码
mysql&gt; grant all privileges on *.* to root@&quot;%&quot; identified by &#39;0&#39;;

mysql&gt; flush privileges;</code></pre><ol start="3">
<li>错误信息：ERROR 1820 (HY000): You must reset your password using ALTER USER statement before executing this statement.</li>
</ol>
<p>首先登录MySQL，然后进行修改密码的操作，常见于第一次登录的时候，如下：</p>
<pre><code>$ mysql -u root -p 
Enter password:

mysql&gt;  set global validate_password_policy=0;

mysql&gt;  alter user &#39;root&#39;@&#39;localhost&#39; identified by &#39;jy@MySQL246&#39;;

mysql&gt;  flush privileges;
</code></pre><ul>
<li><p>MyCat安装以及高可用</p>
</li>
<li><p>MongoDB安装</p>
</li>
</ul>
<p>通过docker的方式来安装MongoDB测试服务器，版本为3.4。操作如下:</p>
<pre><code>// 拉取docker镜像
$ docker pull mongo:3.4
// 运行镜像
$ docker run --name mongod -p 27017:27017 -d mongo:3.4 --auth
// 查看已有的镜像信息
$ docker ps -a 
// 进入mongoDB设置登录用户信息
$ docker exec -it &lt;镜像的md5信息&gt; mongo admin
// 在下面的&gt;后填写以下命令创建用户
&gt; db.createUser({user:&quot;root&quot;,pwd:&quot;root&quot;,roles:[{role:&#39;root&#39;,db:&#39;admin&#39;}]})</code></pre><p>这时MongoDB就部署完成了。</p>
<p>如果是通过软件源安装，这里配置的是4.2版本的mongodb。步骤如下：</p>
<pre><code>// 添加软件源
$ sudo vim /etc/yum.repos.d/mongodb-org-4.2.repo

// 文件中输入以下信息
[mongodb-org-4.2]
name=MongoDB Repository
baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/4.2/x86_64/
gpgcheck=1
enabled=1
gpgkey=https://www.mongodb.org/static/pgp/server-4.2.asc

// :wq 保存文件
// 更新源信息
$  sudo yum update -y
// 开始安装mongodb
$  sudo yum install -y mongodb-org

// 启动已经安装的mongo服务
$ sudo systemctl start mongod
$ sudo systemctl enable mongod

// 针对mongodb进行设置
// 1. 进入mongodb的shell操作空间
$ mongo

// 2. 切换数据库
&gt; use admin

// 3. 添加管理员用户
&gt; db.createUser({ 
        user: &quot;admin&quot;,  
        customData：{description:&quot;superuser&quot;},
        pwd: &quot;admin&quot;,  
        roles: [ { role: &quot;userAdminAnyDatabase&quot;, db: &quot;admin&quot; } ]  
    })  

// 4. 退出，以管理员身份重新登录
&gt; quit()
$ mongo -u admin -p --authenticationDatabase admin
// 输入密码

// 5. 使用指定的库
&gt; use db001

// 6. 对需要操作的库进行授权
&gt; db.createUser({
        user:&quot;user001&quot;,
        pwd:&quot;123456&quot;,
        roles:[
            {role:&quot;readWrite&quot;,db:&quot;db001&quot;},
            &#39;read&#39;// 对其他数据库有只读权限，对db001、db002是读写权限
        ]
    })
// 6. 退出
&gt; quit()</code></pre><p>这样用户权限就授权完毕了，现在需要对mongodb的配置文件进行修改。</p>
<pre><code>// 修改配置文件
$ vim /etc/mongod.conf
    # mongod.conf

    # for documentation of all options, see:
    #   http://docs.mongodb.org/manual/reference/configuration-options/

    # where to write logging data.
    systemLog:
        destination: file
        logAppend: true
        path: /var/log/mongodb/mongod.log

    journal:
        enabled: true
    #  engine:
    #  wiredTiger:

    # how the process runs
    processManagement:
        fork: true  # fork and run in background
        pidFilePath: /var/run/mongodb/mongod.pid  # location of pidfile
        timeZoneInfo: /usr/share/zoneinfo

    # network interfaces
    net:
        port: 27017
        # 修改为所有ip均可访问
        bindIp: 0.0.0.0  # Enter 0.0.0.0,:: to bind to all IPv4 and IPv6 addresses or, alternatively, use the net.bindIpAll setting.

    # 添加授权登录的配置信息
    security:
        authorization: enabled

// :wq 保存退出
// 这时重启mongodb服务  
$  sudo systemctl restart mongod</code></pre><p>这样配置就完成了，随后通过NoSQLBooster for MongoDB工具或者Studio 3T工具进行连接。需要注意的是在javaweb开发时，在配置文件中写入完整的连接字符串，如下：</p>
<pre><code>data:
    mongodb:
        uri: mongodb://mongo_ex:123456@10.0.11.12:27017/test-visualmodel  </code></pre><ul>
<li>MongoDB集群搭建</li>
</ul>
<ol start="3">
<li>缓存Redis</li>
</ol>
<ul>
<li>Redis单体安装</li>
</ul>
<p>Redis版本选择Redis 4.0以上版本，因为4.0以上版本可以支持官方的cluster集群模式构建缓存集群，这里使用4.0.14版本。安装步骤如下：</p>
<pre><code>// 下载Redis安装包
$ wget http://download.redis.io/releases/redis-4.0.14.tar.gz
// 解压
$ tar -zxvf redis-4.0.14.tar.gz
// 进入文件夹准备安装
$ cd redis-4.0.14
// 安装依赖包
$ sudo yum -y install gcc gcc-c++ kernel-devel
// 执行编译
$ make
// 进行安装，确定安装目录到/usr/local/redis
$ make PREFIX=/usr/local/redis install
// copy配置文件redis.conf到/usr/local/redis目录下
$ cp redis.conf /usr/local/redis
// 修改Redis的配置文件
$ vim /usr/local/redis/redis.conf

    # 修改一下配置
    # redis以守护进程的方式运行
    # no表示不以守护进程的方式运行(会占用一个终端)  
    daemonize yes

    # 客户端闲置多长时间后断开连接，默认为0关闭此功能  
    timeout 300

    # 设置redis日志级别，默认级别：notice                    
    loglevel verbose

    # 设置日志文件的输出方式,如果以守护进程的方式运行redis 默认:&quot;&quot; 
    # 并且日志输出设置为stdout,那么日志信息就输出到/dev/null里面去了 
    logfile stdout

    # 设置密码授权
    requirepass &lt;设置密码&gt;

    # 监听ip，允许外网连接
    bind 0.0.0.0

// 输入:wq保存并退出编辑

// 配置环境变量
# vim /etc/profile

// 在文件末尾进行追加
export REDIS_HOME=/usr/local/redis
export PATH=$PATH:$REDIS_HOME/bin

// 输入:wq保存并退出编辑
// 使环境变量生效
# source /etc/profile

// 需要配置开机启动
# cd /etc/init.d
# vim redis

    #!/bin/bash
    #chkconfig: 2345 80 90
    # Simple Redis init.d script conceived to work on Linux systems
    # as it does use of the /proc filesystem.

    PATH=/usr/local/bin:/sbin:/usr/bin:/bin
    REDISPORT=6379
    EXEC=/usr/local/redis/bin/redis-server
    REDIS_CLI=/usr/local/redis/bin/redis-cli

    PIDFILE=/var/run/redis.pid
    CONF=&quot;/usr/local/redis/etc/redis.conf&quot;

    case &quot;$1&quot; in
        start)
            if [ -f $PIDFILE ]
            then
                    echo &quot;$PIDFILE exists, process is already running or crashed&quot;
            else
                    echo &quot;Starting Redis server...&quot;
                    $EXEC $CONF
            fi
            if [ &quot;$?&quot;=&quot;0&quot; ] 
            then
                echo &quot;Redis is running...&quot;
            fi
            ;;
        stop)
            if [ ! -f $PIDFILE ]
            then
                    echo &quot;$PIDFILE does not exist, process is not running&quot;
            else
                    PID=$(cat $PIDFILE)
                    echo &quot;Stopping ...&quot;
                    $REDIS_CLI -p $REDISPORT SHUTDOWN
                    while [ -x ${PIDFILE} ]
                do
                        echo &quot;Waiting for Redis to shutdown ...&quot;
                        sleep 1
                    done
                    echo &quot;Redis stopped&quot;
            fi
            ;;
        restart|force-reload)
            ${0} stop
            ${0} start
            ;;
        *)
        echo &quot;Usage: /etc/init.d/redis {start|stop|restart|force-reload}&quot; &gt;&amp;2
        exit 1
    esac

// 输入:wq保存并退出编辑
// 给脚本增加运行权限
# chmod +x /etc/init.d/redis
// 查看服务列表
# chkconfig --list

// 添加服务
# chkconfig --add redis

// 配置启动级别
# chkconfig --level 2345 redis on

// 使配置生效
# systemctl daemon-reload

// 启动测试
# systemctl start redis   #或者 /etc/init.d/redis start  
# systemctl stop redis   #或者 /etc/init.d/redis stop

// 添加redis开放端口
# firewall-cmd --permanent --zone=public --add-port=6379/tcp
# firewall-cmd --permanent --zone=public --add-port=6379/udp
# firewall-cmd --reload</code></pre><ul>
<li>Redis集群–哨兵模式搭建</li>
</ul>
<p>（进程内缓存使用–caffine–框架进行开发，在编码时使用）</p>
<ol start="4">
<li><p>消息队列</p>
<ul>
<li>RocketMQ搭建</li>
</ul>
</li>
<li><p>依赖管理，仓库和镜像</p>
</li>
</ol>
<p>请参考<a href="/2020/01/31/chi-xu-ji-cheng-shi-jian-da-gang/" title="持续集成实践大纲">持续集成实践大纲</a></p>
<ol start="6">
<li>CI/CD工具链</li>
</ol>
<p>请参考<a href="/2020/01/31/chi-xu-ji-cheng-shi-jian-da-gang/" title="持续集成实践大纲">持续集成实践大纲</a></p>
<ol start="7">
<li>Zookeeper</li>
</ol>
<ul>
<li>Zookeeper安装和集群搭建</li>
</ul>
<ul>
<li><p>使用安装文件进行发布</p>
</li>
<li><p>所在目录：/home/centos/zookeeper-3.4.14</p>
</li>
<li><p>发布地址：<br>  10.0.11.11:21810<br>  10.0.11.12:21810<br>  10.0.11.13:21810</p>
</li>
<li><p>相关命令：</p>
</li>
</ul>
<ol>
<li>配置环境变量</li>
</ol>
<ul>
<li><p>在每一台部署了zookeeper的服务器上</p>
<pre><code>  #修改环境变量文件
  vi /etc/profile

  #增加以下内容
  export ZOOKEEPER_HOME=/usr/zookeeper/zookeeper-3.4.11
  export PATH=$ZOOKEEPER_HOME/bin:$PATH

  #使环境变量生效
  source /etc/profile

  #查看配置结果
  echo $ZOOKEEPER_HOME</code></pre></li>
</ul>
<ol start="2">
<li>配置节点标识</li>
</ol>
<pre><code>    #针对zk01，也就是11服务器：

    echo &quot;1&quot; &gt; /zookeeper/data/myid

    #针对zk02，也就是12服务器：

    echo &quot;2&quot; &gt; /zookeeper/data/myid

    #针对zk03，也就是13服务器：

    echo &quot;3&quot; &gt; /zookeeper/data/myid</code></pre><ol start="3">
<li>配置文件修改</li>
</ol>
<ul>
<li><p>在每一台部署了zookeeper的服务器上</p>
<pre><code>  #进入ZooKeeper配置目录
  cd $ZOOKEEPER_HOME/conf

  #新建配置文件
  vim zoo.cfg

  #写入以下内容并保存

  tickTime=2000
  initLimit=10
  syncLimit=5
  dataDir=/home/centos/zookeeper-3.4.14/data
  dataLogDir=/home/centos/zookeeper-3.4.14/logs
  clientPort=21810
  server.1=10.0.11.11:28880:38880
  server.2=10.0.11.12:28880:38880
  server.3=10.0.11.13:28880:38880        </code></pre></li>
</ul>
<ol start="4">
<li>开放端口信息</li>
</ol>
<ul>
<li><p>在每一台部署了zookeeper的服务器上</p>
<pre><code>  sudo firewall-cmd --add-port=21810/tcp --permanent
  sudo firewall-cmd --add-port=28880/tcp --permanent
  sudo firewall-cmd --add-port=38880/tcp --permanent
  sudo firewall-cmd --reload</code></pre></li>
</ul>
<ol start="5">
<li>启动</li>
</ol>
<ul>
<li><p>在每一台部署了zookeeper的服务器上</p>
<pre><code>  #进入ZooKeeper bin目录
  cd $ZOOKEEPER_HOME/bin

  #启动
  nohup sh zkServer.sh start &amp;</code></pre></li>
</ul>
<ul>
<li>配置方式：使用ZooInspector访问zookeeper服务并进行配置</li>
</ul>
<ul>
<li><a href="https://juejin.im/post/5ba879ce6fb9a05d16588802" target="_blank" rel="noopener">参考地址</a></li>
</ul>
<ol start="8">
<li>ELK体系</li>
</ol>
<p>请参考<a href="/2020/01/15/elk-dan-ji-ri-zhi-xi-tong-da-jian/" title="ELK单机日志系统搭建">ELK单机日志系统搭建</a></p>
<ol start="9">
<li>Docker+kubernetes体系</li>
</ol>
<ol start="10">
<li>API管理工具–YApi安装</li>
</ol>
<p>启动方式，先启动MongoDB，再通过pm2 启动yapi项目</p>
<p>请参考<a href="http://yapi.demo.qunar.com/" target="_blank" rel="noopener">YApi官方</a>安装方式。</p>
<ol start="11">
<li>JIRA/Confluence的安装部署</li>
</ol>
<ul>
<li><p>前提：需要安装docker和docker-compose，下载docker镜像包</p>
</li>
<li><p>首先启动数据库</p>
<pre><code>  docker pull mysql:5.7

  # 启动jira的数据库
  docker run --name mysql-jira --restart always -p 46001:3306 -e MYSQL_ROOT_PASSWORD=123456 -e MYSQL_DATABASE=jira -e MYSQL_USER=jira -e MYSQL_PASSWORD=jira -d mysql:5.7 --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

  # 针对jira的数据库设置

  vim /etc/mysql/conf.d/mysql.cnf

  添加下面的内容：

  [mysql]
  default-character-set=utf8
  [client]
  default-character-set=uft8

  # 启动confluence的数据库
  docker run --name mysql-confluence --restart always -p 46003:3306 -e MYSQL_ROOT_PASSWORD=123456 -e MYSQL_DATABASE=confluence -e MYSQL_USER=confluence -e MYSQL_PASSWORD=confluence -d mysql:5.7 --character-set-server=utf8 --collation-server=utf8_bin

  # 针对confluence的数据库的设置

  vim /etc/mysql/conf.d/mysql.cnf

  添加下面的内容：

  [mysql]
  default-character-set=utf8

  [client]
  default-character-set=utf8

  [mysqld]
  character-set-server=utf8
  collation-server=utf8_bin</code></pre></li>
<li><p>下载需要的jira和Confluence镜像信息</p>
<pre><code>  git clone https://github.com/zhangguanzhang/Dockerfile.git

  cd ./Dockerfile/atlassian-jira</code></pre></li>
</ul>
<ul>
<li><p>构建jira镜像</p>
<pre><code>  # 不要忘记后面的“.”，表示当前目录下进行构建
  docker build -t ht-jira:v7 . 

  # 等待一段时间进行构建

  # 查看已经构建完成的镜像
  docker images 

  REPOSITORY                              TAG                 IMAGE ID            CREATED             SIZE</code></pre><p>ht-jira                                 v1                  c4a747622b73        45 seconds ago      532MB</p>
<pre><code>  # 启动镜像

  docker run --restart always --detach --link mysql-jira:mysql --publish 46002:8080 ht-jira:v7</code></pre></li>
<li><p>构建confluence镜像</p>
<pre><code>  # 不要忘记后面的“.”，表示当前目录下进行构建
  docker build -t ht-confluence:v2 . 

  # 等待一段时间进行构建

  # 查看已经构建完成的镜像
  docker images 

  REPOSITORY                         TAG                 IMAGE ID            CREATED             SIZE</code></pre><p>ht-confluence                      v2                  75d3834d330f        27 minutes ago      785MB</p>
<pre><code>  # 启动镜像

  docker run --restart always --detach --link mysql-confluence:mysql --publish 46004:8080 ht-confluence:v2</code></pre></li>
<li><p>访问地址</p>
</li>
</ul>
<p>jira：10.0.11.11:46002<br>confluence：10.0.11.12.46004</p>
<ul>
<li><p>参考地址：</p>
<pre><code>  * https://zhangguanzhang.github.io/2019/02/19/jira-confluence/#jira%E6%95%B0%E6%8D%AE%E5%BA%93%E9%85%8D%E7%BD%AE

  * https://blog.csdn.net/weixin_38229356/article/details/84875205

  * https://github.com/zhangguanzhang/Dockerfile.git

  * confluence文档：https://www.cwiki.us/pages/viewpage.action?pageId=917513

  * jira文档：https://www.cwiki.us/pages/viewpage.action?pageId=2393502</code></pre></li>
</ul>
<h2 id="关于服务器内核自动升级问题的解决"><a href="#关于服务器内核自动升级问题的解决" class="headerlink" title="关于服务器内核自动升级问题的解决"></a>关于服务器内核自动升级问题的解决</h2><p>由于部分机器进行了</p>
<pre><code>sudo yum update
</code></pre><p>操作，导致内核信息进行了升级，导致有一些机器在启动的时候出现了黑屏和无法启动的情况。</p>
<p>由于在启动时，默认选择了新升级的内核进行了启动，导致报错。如下：</p>
<p><img src="%E6%96%B0%E5%86%85%E6%A0%B8%E5%90%AF%E5%8A%A8%E6%8A%A5%E9%94%99.png" alt></p>
<p>目前可用的稳定版内核为：3.10.0-1062.12.1.el7.x86_64，或者低于该版本的内核信息。</p>
<p>以192.168.229.221机器为例进行查看和修改，首先登陆192.168.229.221，查看已安装的内核信息：</p>
<pre><code>$ sudo rpm -qa |grep kernel
kernel-tools-libs-3.10.0-1127.10.1.el7.x86_64
kernel-tools-3.10.0-1127.10.1.el7.x86_64
abrt-addon-kerneloops-2.1.11-57.el7.centos.x86_64
kernel-3.10.0-1127.10.1.el7.x86_64
kernel-3.10.0-862.el7.x86_64
kernel-3.10.0-1062.12.1.el7.x86_64

$ sudo rpm -e kernel.x86_64
error: &quot;kernel.x86_64&quot; specifies multiple packages:
  kernel-3.10.0-862.el7.x86_64
  kernel-3.10.0-1062.12.1.el7.x86_64
  kernel-3.10.0-1127.10.1.el7.x86_64
</code></pre><p>然后查看系统可用内核，查看启动时可选择的内核信息：</p>
<pre><code>$ sudo cat /boot/grub2/grub.cfg |grep menuentry
if [ x&quot;${feature_menuentry_id}&quot; = xy ]; then
  menuentry_id_option=&quot;--id&quot;
  menuentry_id_option=&quot;&quot;
export menuentry_id_option
menuentry &#39;CentOS Linux (3.10.0-1127.10.1.el7.x86_64) 7 (Core)&#39; --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option &#39;gnulinux-3.10.0-862.el7.x86_64-advanced-f67e74a9-a85f-48b9-b521-32bdb355ab80&#39; {
menuentry &#39;CentOS Linux (3.10.0-1062.12.1.el7.x86_64) 7 (Core)&#39; --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option &#39;gnulinux-3.10.0-862.el7.x86_64-advanced-f67e74a9-a85f-48b9-b521-32bdb355ab80&#39; {
menuentry &#39;CentOS Linux (3.10.0-862.el7.x86_64) 7 (Core)&#39; --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option &#39;gnulinux-3.10.0-862.el7.x86_64-advanced-f67e74a9-a85f-48b9-b521-32bdb355ab80&#39; {
menuentry &#39;CentOS Linux (0-rescue-ffe45569e61149c0a79c77c7b38c8e33) 7 (Core)&#39; --class centos --class gnu-linux --class gnu --class os --unrestricted $menuentry_id_option &#39;gnulinux-0-rescue-ffe45569e61149c0a79c77c7b38c8e33-advanced-f67e74a9-a85f-48b9-b521-32bdb355ab80&#39; {
</code></pre><p>下一步查看当前内核信息：</p>
<pre><code>$ uname -a
Linux dev-k8s-node01 3.10.0-1127.10.1.el7.x86_64 #1 SMP Wed Jun 3 14:28:03 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
</code></pre><p>目前默认的就是这个3.10.0-1127的内核进行启动的，可能会存在问题，这时候需要修改开机时的默认使用的内核。</p>
<pre><code>$ sudo grub2-set-default  &#39;CentOS Linux (3.10.0-1062.12.1.el7.x86_64) 7 (Core)&#39;

$ sudo grub2-editenv list
saved_entry=CentOS Linux (3.10.0-1062.12.1.el7.x86_64) 7 (Core)</code></pre><p>修改完成后，进行如下操作：</p>
<ol>
<li>删除存在启动问题内核</li>
</ol>
<pre><code>$ sudo rpm -qa | grep kernel
kernel-tools-libs-3.10.0-1127.10.1.el7.x86_64
kernel-tools-3.10.0-1127.10.1.el7.x86_64
abrt-addon-kerneloops-2.1.11-57.el7.centos.x86_64
kernel-3.10.0-1127.10.1.el7.x86_64
kernel-3.10.0-862.el7.x86_64
kernel-3.10.0-1062.12.1.el7.x86_64

$ sudo yum remove kernel-3.10.0-1127.10.1.el7.x86_64
Loaded plugins: fastestmirror, langpacks, versionlock
Skipping the running kernel: kernel-3.10.0-1127.10.1.el7.x86_64
No Packages marked for removal 
</code></pre><p>删除内核时出现上述错误，是因为当前内核正在使用，需要机器进行重启后才能删除。</p>
<ol start="2">
<li>禁用内核自动更新</li>
</ol>
<pre><code>// 复制保留原来的配置文件
$ sudo cp /etc/yum.conf /etc/yum.conf.bak

$ sudo vim /etc/yum.conf
// 在[main]的最后添加 exclude=kernel*
exclude=kernel*

// :wq保存退出
</code></pre><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ol>
<li>硬盘扩容</li>
</ol>
<p>参考地址：<a href="http://ttlop.com/2016/11/29/Centos-7-LVM-%E7%A3%81%E7%9B%98%E6%89%A9%E5%AE%B9/" target="_blank" rel="noopener">参考链接</a></p>
<ol start="2">
<li><p>修改运行中的docker配置文件</p>
<p> 首先停止所有的容器</p>
<pre><code> $ sudo docker stop $(docker ps -a | awk &#39;{ print $1}&#39; | tail -n +2)</code></pre><p> 然后停止docker服务</p>
<pre><code> $ sudo systemctl stop docker</code></pre><p> 备份容器的配置文件（需要管理员权限）</p>
<pre><code> # cd /var/lib/docker/containers/de9c6501cdd3(容器编号)
 # cp hostconfig.json hostconfig.json.bak
 # cp config.v2.json config.v2.json.bak</code></pre><p> 修改配置文件，例如</p>
<pre><code> # vim config.v2.json</code></pre><p> 重启docker服务</p>
<pre><code> $ sudo systemctl start docker</code></pre><p> 重启docker镜像</p>
<pre><code> $ sudo docker start $(docker ps -a | awk &#39;{ print $1}&#39; | tail -n +2</code></pre></li>
<li><p>CentOS 7 安装方式选择？</p>
</li>
</ol>
<ul>
<li><p>Desktop ：基本的桌面系统，包括常用的桌面软件，如文档查看工具。</p>
</li>
<li><p>Minimal Desktop：基本的桌面系统，包含的软件更少。</p>
</li>
<li><p>Minimal：基本的系统，不含有任何可选的软件包。</p>
</li>
<li><p>Basic Server ：安装的基本系统的平台支持，不包含桌面。</p>
</li>
<li><p>Database Server：基本系统平台，加上MySQL和PostgreSQL数据库，无桌面。</p>
</li>
<li><p>Web Server：基本系统平台，加上PHP，Web server，还有MySQL和PostgreSQL数据库的客户端，无桌面。</p>
</li>
<li><p>Virtual Host：基本系统加虚拟平台。</p>
</li>
<li><p>Software Development Workstation：包含软件包较多，基本系统，虚拟化平台，桌面环境，开发工具。</p>
</li>
</ul>
<p>而安装Linux基本是用来构建服务器的，所以基本上选择Basic Server即可。如果业务环境无法连接外网，尽量选择比minimal安装更高级别的安装方式，例如Software Development Workstation方式。</p>
<ol start="4">
<li>选取Linux版本原则</li>
</ol>
<p>尽量选择LTS（长期支持版）版本，5年期支持，社区有保障。第二选择就是选择次新版本，例如当前发行版本为CentOS 7.6，可以选择CentOS 7.4版本。尽量不要选择CentOS 6系列，因为长期维护支持马上到期。</p>
<p>对照表：</p>
<table>
<thead>
<tr>
<th>发行版本</th>
<th>全力支持到期</th>
<th>维护支持到期</th>
</tr>
</thead>
<tbody><tr>
<td>CentOS 6</td>
<td>2016</td>
<td>2020-11</td>
</tr>
<tr>
<td>CentOS 7</td>
<td>2019</td>
<td>2024-06</td>
</tr>
</tbody></table>
<ol start="5">
<li>利用scp命令上传下载文件夹</li>
</ol>
<p>使用scp命令，远程上传下载文件/文件夹<br>1、从服务器下载文件<br>scp username@servername:/path/filename /local/path<br>例如: scp <a href="mailto:ubuntu@117.50.20.56" target="_blank" rel="noopener">ubuntu@117.50.20.56</a>:/ygf/data/data.txt /desktop/ygf   把117.50.20.56上的/ygf/data/data.txt 的文件下载到/desktop/ygf目录中</p>
<p>2、上传本地文件到服务器<br>scp /local/path/local_filename username@servername:/path<br>例如: scp /ygf/learning/deeplearning.doc  <a href="mailto:ubuntu@117.50.20.56" target="_blank" rel="noopener">ubuntu@117.50.20.56</a>:/ygf/learning    把本机/ygf/learning/目录下的deeplearning.doc文件上传到117.50.20.56这台服务器上的/ygf/learning目录中</p>
<p>3、从服务器下载整个目录<br>scp -r username@servername:/path /path<br>例如: scp  -r  <a href="mailto:ubuntu@117.50.20.56" target="_blank" rel="noopener">ubuntu@117.50.20.56</a>:/home/ygf/data  /local/local_dir    “-r”命令是文件夹目录，把当前/home/ygf/data目录下所有文件下载到本地/local/local_dir目录中</p>
<p>4、上传目录到服务器<br>scp  -r  /path  username@servername:/path<br>例如: scp -r  /ygf/test  <a href="mailto:ubuntu@117.50.20.56" target="_blank" rel="noopener">ubuntu@117.50.20.56</a>:/ygf/tx     “-r”命令是文件夹目录，把当前/ygf/test目录下所有文件上传到服务器的/ygf/tx/目录中</p>
<p>参考自：<a href="https://www.cnblogs.com/tectal/p/9478326.html" target="_blank" rel="noopener">https://www.cnblogs.com/tectal/p/9478326.html</a></p>
<ol start="6">
<li>关于shell脚本编写问题</li>
</ol>
<p>执行 shell 脚本 \r 问题解决<br>一看应该是 windows 的回车换行跟 linux 换行差异，百度了一下，的确有很多类似问题，在 windows 下编辑 shell 文件，输入的回车是 “\r\n” ，导致在 linux 下执行 shell 脚本时报这个 \r 的错。<br>怎么办？想办法解决。<br>让开发或测试自己想办法转化或者在 linux 环境编辑这个 build.sh 很明显不现实，在服务器安装 dos2unix 来转化 build.sh 我又要在主从节点分别重新构建镜像，麻烦。想了想用替换的方式看能否实现，百度一下，使用 sed -i ‘s/\r//‘ 来处理 build.sh 后再执行，即 sed -i ‘s/\r//‘ build.sh &amp;&amp; bash build.sh，完美解决问题，大功告成！！！</p>
<pre><code>$ sed -i &#39;s/\r//&#39; init.sh
$ sed -i &#39;s/\r//&#39; ssh-keygen-send.sh</code></pre><ol start="7">
<li>使用yumdownloader对依赖库进行下载</li>
</ol>
<pre><code>// 创建下载的文件夹
$ sudo mkdir -p /opt/download-package/

// 如果未安装yum-utils，可以先安装
$ sudo yum install yum-utils -y

// 查看 yum-utils 软件包有没有 yumdownloader，如果有输出代表可用
$ sudo rpm -ql yum-utils | grep yumdownloader
/usr/bin/yumdownloader
/usr/share/man/man1/yumdownloader.1.gz

// 下载，--resolve：下载依赖，--destdir：指定下载目录， --donwloadonly：只下载不更新
$ sudo yumdownloader java-1.8.0-openjdk.x86_64 --resolve --destdir=/opt/download-package/ --donwloadonly
</code></pre><p><strong>注意：</strong>如果openjdk已经安装了，容易导致下载时无法下载相关的依赖信息。</p>
<ol start="8">
<li>编辑/etc/profile文件导致命令not found的问题</li>
</ol>
<pre><code>
cat 

</code></pre><p>重新配置export PATH信息，中午整理</p>
<ol start="9">
<li>查看要安装的依赖信息版本</li>
</ol>
<pre><code>$ sudo yum list available docker-ce --showduplicates
</code></pre><ol start="10">
<li>alternatives使用</li>
</ol>
<pre><code>
// --display
// 看到一个命令的所有可选命令
# update-alternatives --display java  

// --config
// 该参数用于给某个命令选择一个link值，相当于在可用值之中进行切换
// 列出系统中的所有可用值
# update-alternatives --config java 

// --install
// 该参数用于添加一个命令的link值，相当于添加一个可用值，其中slave非常有用。
# update-alternatives –install /usr/bin/java java /usr/local/jre1.6.0_20/bin/javac 100  
# update-alternatives –install /usr/bin/java java /usr/local/jre1.6.0_20/bin/javac 100 –slave /usr/bin/javac javac /usr/local/jre1.6.0_20/bin/javac  

// --remove
// 该参数用于删除一个命令的link值，其附带的slave也将一起删除。
# update-alternatives –remove java /usr/local/jre1.6.0_20/bin/java  
</code></pre><ol start="11">
<li>openjdk的卸载与安装(rpm本地包)</li>
</ol>
<p>打开rpm解压后的文件夹。</p>
<p>卸载方式：</p>
<pre><code>// ./*.rpm包是指所有的jdk依赖包
# rpm -e --nodeps ./*.rpm

// 或者使用

# yum autoremove ./*.rpm

# yum autoremove java-1.8.0-openjdk*
</code></pre><p>安装方式：</p>
<pre><code>// ./*.rpm包是指所有的jdk依赖包
# rpm -ivh ./*.rpm --nodeps --force

// 或者使用

# yum localinstall ./*.rpm
</code></pre>
            </div>
            <hr />

            
            <style>
    #reward {
        margin: 40px 0;
        text-align: center;
    }

    #reward .reward-link {
        font-size: 1.88rem;
    }

    #reward .btn-floating:hover {
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2), 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #rewardModal {
        width: 320px;
        height: 350px;
    }

    #rewardModal .reward-title {
        margin: 15px auto;
        padding-bottom: 5px;
    }

    #rewardModal .modal-content {
        padding: 10px;
    }

    #rewardModal .close {
        position: absolute;
        right: 15px;
        top: 15px;
        color: rgba(0, 0, 0, 0.5);
        font-size: 1.3rem;
        line-height: 20px;
        cursor: pointer;
    }

    #rewardModal .close:hover {
        color: #ef5350;
        transform: scale(1.3);
        -moz-transform:scale(1.3);
        -webkit-transform:scale(1.3);
        -o-transform:scale(1.3);
    }

    #rewardModal .reward-tabs {
        margin: 0 auto;
        width: 210px;
    }

    .reward-tabs .tabs {
        height: 38px;
        margin: 10px auto;
        padding-left: 0;
    }

    .reward-content ul {
        padding-left: 0 !important;
    }

    .reward-tabs .tabs .tab {
        height: 38px;
        line-height: 38px;
    }

    .reward-tabs .tab a {
        color: #fff;
        background-color: #ccc;
    }

    .reward-tabs .tab a:hover {
        background-color: #ccc;
        color: #fff;
    }

    .reward-tabs .wechat-tab .active {
        color: #fff !important;
        background-color: #22AB38 !important;
    }

    .reward-tabs .alipay-tab .active {
        color: #fff !important;
        background-color: #019FE8 !important;
    }

    .reward-tabs .reward-img {
        width: 210px;
        height: 210px;
    }
</style>

<div id="reward">
    <a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-large waves-effect waves-light red">赏</a>

    <!-- Modal Structure -->
    <div id="rewardModal" class="modal">
        <div class="modal-content">
            <a class="close modal-close"><i class="fa fa-close"></i></a>
            <h4 class="reward-title">写作不易，客官能否打赏一杯奶茶？</h4>
            <div class="reward-content">
                <div class="reward-tabs">
                    <ul class="tabs row">
                        <li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li>
                        <li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li>
                    </ul>
                    <div id="alipay">
                        <img src="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码">
                    </div>
                    <div id="wechat">
                        <img src="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(function () {
        $('.tabs').tabs();
    });
</script>
            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            

    <div class="reprint" id="reprint-statement">
        <p class="reprint-tip">
            <i class="fa fa-exclamation-triangle"></i>&nbsp;&nbsp;
            <span>转载规则</span>
        </p>
        
            <div class="center-align">
                <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                    <img alt=""
                         style="border-width:0"
                         src="https://i.creativecommons.org/l/by/4.0/88x31.png"/>
                </a>
            </div>
            <br/>
            <span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text"
                  property="dct:title" rel="dct:type">
                    《Linux日常运维操作》
                </span> 由
            <a xmlns:cc="http://creativecommons.org/ns#" href="/2020/01/31/linux-ri-chang-yun-wei-cao-zuo/" property="cc:attributionName"
               rel="cc:attributionURL">
                JamesLiAndroid
            </a> 采用
            <a rel="license" href="https://creativecommons.org/licenses/by/4.0/deed.zh">
                知识共享署名 4.0 国际许可协议
            </a>进行许可。
        
    </div>

    <script async defer>
      document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }
    </script>


        </div>
    </div>

    

    

    

    

    
    <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }

    #vcomments input[type=text],
    #vcomments input[type=email],
    #vcomments input[type=url],
    #vcomments textarea {
        box-sizing: border-box;
    }

    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #42b983;
        font-weight: 500;
        text-decoration: underline;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div id="vcomments" class="card-content"></div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>
<!-- <script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script> -->

<script>
    new Valine({
        el: '#vcomments',
        appId: '',
        appKey: '',
        notify: 'false' === 'true',
        verify: 'false' === 'true',
        visitor: 'false' === 'true',
        avatar: 'wavatar',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: '如果你没有GitHub账号，还可以在这里评论啦！'
    });
</script>

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2020/01/31/chi-xu-ji-cheng-shi-jian-da-gang/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/11.jpg" class="responsive-img" alt="持续集成实践大纲">
                        
                        <span class="card-title">持续集成实践大纲</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            持续集成实践当前进度
未完成触发规则的内容，jenkins设置和gitlab中webhook设置
未完成镜像环境变量的传递
jenkins插件列表需要重新整理
未完成Dockerfile的自定义编写以及环境变量的使用

前提
尽量进行一步一
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2020-01-31
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/CI-CD/" class="post-category" target="_blank">
                                    CI/CD
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Linux-DevOps-CI-CD/" target="_blank">
                        <span class="chip bg-color">Linux DevOps CI/CD</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2020/01/28/hello-world/">
                    <div class="card-image">
                        
                        
                        <img src="/medias/featureimages/11.jpg" class="responsive-img" alt="Hello World">
                        
                        <span class="card-title">Hello World</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Hello World
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2020-01-28
                            </span>
                        <span class="publish-author">
                            
                        </span>
                    </div>
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: 时代与猫的脚步<br />'
            + '作者: JamesLiAndroid<br />'
            + '链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。感谢您的支持。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () { bodyElement.removeChild(newdiv); }, 200);
    });
</script>

    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1, h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\(', '\)']]}
    });
</script>

    <footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            &copy; 2019 WeiYang. All Rights Reserved.
            <a href="http://www.beian.miit.gov.cn">鲁ICP备17011350号</a>
            
            &nbsp;<i class="fa fa-area-chart"></i>&nbsp;站点总字数:&nbsp;
            <span class="white-color">287.2k</span>
            

            <br>
            <span id="sitetime"></span>

            
            
        </div>
        <div class="col s12 m4 l4 social-link ">
    <a href="https://github.com/JamesLiAndroid" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:lsy1234567@163.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="https://zhihu.com/people/li-tian-90-66" class="tooltipped" target="_blank" data-tooltip="访问我的知乎" data-position="top" data-delay="50">
        <i class="fa fa-inverse">知</i>
    </a>







    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
</div>
    </div>
</footer>

<div class="progress-bar"></div>

<!-- 不蒜子计数初始值纠正 -->
<script>
    $(document).ready(function () {

        var int = setInterval(fixCount, 50);
        var pvcountOffset = 80000;
        var uvcountOffset = 20000;

        function fixCount() {
            if (document.getElementById("busuanzi_container_site_pv").style.display != "none") {
                $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + pvcountOffset);
                clearInterval(int);
            }
            if ($("#busuanzi_container_site_pv").css("display") != "none") {
                $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + uvcountOffset); // 加上初始数据 
                clearInterval(int);
            }
        }
    });
</script>

<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();
        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */
        var t1 = Date.UTC(2020, 01, 28, 00, 00, 00); //北京时间2018-2-13 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes * minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "本站已运行 " + diffYears + " 年 " + diffDays + " 天 " + diffHours + " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒";
    }/*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
</script>

    <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
    <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


    <script src="/libs/materialize/materialize.min.js"></script>
    <script src="/libs/masonry/masonry.pkgd.min.js"></script>
    <script src="/libs/aos/aos.js"></script>
    <script src="/libs/scrollprogress/scrollProgress.min.js"></script>
    <script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
    <script src="/js/matery.js"></script>

    <script type="text/javascript"> var OriginTitile = document.title, st; document.addEventListener("visibilitychange", function () { document.hidden ? (document.title = "Σ(っ °Д °;)っ喔哟，崩溃啦！", clearTimeout(st)) : (document.title = "φ(゜▽゜*)♪咦，又好了！", st = setTimeout(function () { document.title = OriginTitile }, 3e3)) })
    </script>

    <!-- Global site tag (gtag.js) - Google Analytics -->



    
    <script src="/libs/others/clicklove.js"></script>
    

    

    <!-- 雪花特效 -->
    

</body>

</html>